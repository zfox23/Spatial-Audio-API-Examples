var HighFidelityAudio;HighFidelityAudio=(()=>{var e={591:(e,t,i)=>{"use strict";const{Deflate:n,deflate:a,deflateRaw:s,gzip:o}=i(555),{Inflate:r,inflate:l,inflateRaw:d,ungzip:u}=i(843),h=i(619);e.exports.Deflate=n,e.exports.deflate=a,e.exports.deflateRaw=s,e.exports.gzip=o,e.exports.Inflate=r,e.exports.inflate=l,e.exports.inflateRaw=d,e.exports.ungzip=u,e.exports.constants=h},555:(e,t,i)=>{"use strict";const n=i(405),a=i(236),s=i(373),o=i(898),r=i(292),l=Object.prototype.toString,{Z_NO_FLUSH:d,Z_SYNC_FLUSH:u,Z_FULL_FLUSH:h,Z_FINISH:c,Z_OK:_,Z_STREAM_END:g,Z_DEFAULT_COMPRESSION:m,Z_DEFAULT_STRATEGY:f,Z_DEFLATED:p}=i(619);function v(e){this.options=a.assign({level:m,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let i=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==_)throw new Error(o[i]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?s.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=n.deflateSetDictionary(this.strm,e),i!==_)throw new Error(o[i]);this._dict_set=!0}}function S(e,t){const i=new v(t);if(i.push(e,!0),i.err)throw i.msg||o[i.err];return i.result}v.prototype.push=function(e,t){const i=this.strm,a=this.options.chunkSize;let o,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?c:d,"string"==typeof e?i.input=s.string2buf(e):"[object ArrayBuffer]"===l.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),(r===u||r===h)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(o=n.deflate(i,r),o===g)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),o=n.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===_;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},v.prototype.onData=function(e){this.chunks.push(e)},v.prototype.onEnd=function(e){e===_&&(this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Deflate=v,e.exports.deflate=S,e.exports.deflateRaw=function(e,t){return(t=t||{}).raw=!0,S(e,t)},e.exports.gzip=function(e,t){return(t=t||{}).gzip=!0,S(e,t)},e.exports.constants=i(619)},843:(e,t,i)=>{"use strict";const n=i(948),a=i(236),s=i(373),o=i(898),r=i(292),l=i(401),d=Object.prototype.toString,{Z_NO_FLUSH:u,Z_FINISH:h,Z_OK:c,Z_STREAM_END:_,Z_NEED_DICT:g,Z_STREAM_ERROR:m,Z_DATA_ERROR:f,Z_MEM_ERROR:p}=i(619);function v(e){this.options=a.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;let i=n.inflateInit2(this.strm,t.windowBits);if(i!==c)throw new Error(o[i]);if(this.header=new l,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=s.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=n.inflateSetDictionary(this.strm,t.dictionary),i!==c)))throw new Error(o[i])}function S(e,t){const i=new v(t);if(i.push(e),i.err)throw i.msg||o[i.err];return i.result}v.prototype.push=function(e,t){const i=this.strm,a=this.options.chunkSize,o=this.options.dictionary;let r,l,v;if(this.ended)return!1;for(l=t===~~t?t:!0===t?h:u,"[object ArrayBuffer]"===d.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(a),i.next_out=0,i.avail_out=a),r=n.inflate(i,l),r===g&&o&&(r=n.inflateSetDictionary(i,o),r===c?r=n.inflate(i,l):r===f&&(r=g));i.avail_in>0&&r===_&&i.state.wrap>0&&0!==e[i.next_in];)n.inflateReset(i),r=n.inflate(i,l);switch(r){case m:case f:case g:case p:return this.onEnd(r),this.ended=!0,!1}if(v=i.avail_out,i.next_out&&(0===i.avail_out||r===_))if("string"===this.options.to){let e=s.utf8border(i.output,i.next_out),t=i.next_out-e,n=s.buf2string(i.output,e);i.next_out=t,i.avail_out=a-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(n)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==c||0!==v){if(r===_)return r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},v.prototype.onData=function(e){this.chunks.push(e)},v.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},e.exports.Inflate=v,e.exports.inflate=S,e.exports.inflateRaw=function(e,t){return(t=t||{}).raw=!0,S(e,t)},e.exports.ungzip=S,e.exports.constants=i(619)},236:e=>{"use strict";const t=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);e.exports.assign=function(e){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const n=i.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const i in n)t(n,i)&&(e[i]=n[i])}}return e},e.exports.flattenChunks=e=>{let t=0;for(let i=0,n=e.length;i<n;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,n=0,a=e.length;t<a;t++){let a=e[t];i.set(a,n),n+=a.length}return i}},373:e=>{"use strict";let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){t=!1}const i=new Uint8Array(256);for(let e=0;e<256;e++)i[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;i[254]=i[254]=1,e.exports.string2buf=e=>{let t,i,n,a,s,o=e.length,r=0;for(a=0;a<o;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),r+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(r),s=0,a=0;s<r;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<o&&(n=e.charCodeAt(a+1),56320==(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),a++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},e.exports.buf2string=(e,n)=>{let a,s;const o=n||e.length,r=new Array(2*o);for(s=0,a=0;a<o;){let t=e[a++];if(t<128){r[s++]=t;continue}let n=i[t];if(n>4)r[s++]=65533,a+=n-1;else{for(t&=2===n?31:3===n?15:7;n>1&&a<o;)t=t<<6|63&e[a++],n--;n>1?r[s++]=65533:t<65536?r[s++]=t:(t-=65536,r[s++]=55296|t>>10&1023,r[s++]=56320|1023&t)}}return((e,i)=>{if(i<65534&&e.subarray&&t)return String.fromCharCode.apply(null,e.length===i?e:e.subarray(0,i));let n="";for(let t=0;t<i;t++)n+=String.fromCharCode(e[t]);return n})(r,s)},e.exports.utf8border=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+i[e[n]]>t?n:t}},69:e=>{"use strict";e.exports=(e,t,i,n)=>{let a=65535&e|0,s=e>>>16&65535|0,o=0;for(;0!==i;){o=i>2e3?2e3:i,i-=o;do{a=a+t[n++]|0,s=s+a|0}while(--o);a%=65521,s%=65521}return a|s<<16|0}},619:e=>{"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},869:e=>{"use strict";const t=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})());e.exports=(e,i,n,a)=>{const s=t,o=a+n;e^=-1;for(let t=a;t<o;t++)e=e>>>8^s[255&(e^i[t])];return-1^e}},405:(e,t,i)=>{"use strict";const{_tr_init:n,_tr_stored_block:a,_tr_flush_block:s,_tr_tally:o,_tr_align:r}=i(342),l=i(69),d=i(869),u=i(898),{Z_NO_FLUSH:h,Z_PARTIAL_FLUSH:c,Z_FULL_FLUSH:_,Z_FINISH:g,Z_BLOCK:m,Z_OK:f,Z_STREAM_END:p,Z_STREAM_ERROR:v,Z_DATA_ERROR:S,Z_BUF_ERROR:b,Z_DEFAULT_COMPRESSION:A,Z_FILTERED:w,Z_HUFFMAN_ONLY:C,Z_RLE:y,Z_FIXED:x,Z_DEFAULT_STRATEGY:D,Z_UNKNOWN:R,Z_DEFLATED:I}=i(619),k=258,T=262,F=103,H=113,E=666,U=(e,t)=>(e.msg=u[t],t),P=e=>(e<<1)-(e>4?9:0),O=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let L=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask;const N=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},z=(e,t)=>{s(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,N(e.strm)},M=(e,t)=>{e.pending_buf[e.pending++]=t},Z=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Q=(e,t,i,n)=>{let a=e.avail_in;return a>n&&(a=n),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),1===e.state.wrap?e.adler=l(e.adler,t,a,i):2===e.state.wrap&&(e.adler=d(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},B=(e,t)=>{let i,n,a=e.max_chain_length,s=e.strstart,o=e.prev_length,r=e.nice_match;const l=e.strstart>e.w_size-T?e.strstart-(e.w_size-T):0,d=e.window,u=e.w_mask,h=e.prev,c=e.strstart+k;let _=d[s+o-1],g=d[s+o];e.prev_length>=e.good_match&&(a>>=2),r>e.lookahead&&(r=e.lookahead);do{if(i=t,d[i+o]===g&&d[i+o-1]===_&&d[i]===d[s]&&d[++i]===d[s+1]){s+=2,i++;do{}while(d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&d[++s]===d[++i]&&s<c);if(n=k-(c-s),s=c-k,n>o){if(e.match_start=t,o=n,n>=r)break;_=d[s+o-1],g=d[s+o]}}}while((t=h[t&u])>l&&0!=--a);return o<=e.lookahead?o:e.lookahead},K=e=>{const t=e.w_size;let i,n,a,s,o;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-T)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,n=e.hash_size,i=n;do{a=e.head[--i],e.head[i]=a>=t?a-t:0}while(--n);n=t,i=n;do{a=e.prev[--i],e.prev[i]=a>=t?a-t:0}while(--n);s+=t}if(0===e.strm.avail_in)break;if(n=Q(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=L(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=L(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<T&&0!==e.strm.avail_in)},V=(e,t)=>{let i,n;for(;;){if(e.lookahead<T){if(K(e),e.lookahead<T&&t===h)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=L(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-T&&(e.match_length=B(e,i)),e.match_length>=3)if(n=o(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=L(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=L(e,e.ins_h,e.window[e.strstart+1]);else n=o(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(z(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===g?(z(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(z(e,!1),0===e.strm.avail_out)?1:2},j=(e,t)=>{let i,n,a;for(;;){if(e.lookahead<T){if(K(e),e.lookahead<T&&t===h)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=L(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-T&&(e.match_length=B(e,i),e.match_length<=5&&(e.strategy===w||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,n=o(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=L(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(z(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=o(e,0,e.window[e.strstart-1]),n&&z(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=o(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===g?(z(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(z(e,!1),0===e.strm.avail_out)?1:2};function $(e,t,i,n,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=a}const W=[new $(0,0,0,0,((e,t)=>{let i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(K(e),0===e.lookahead&&t===h)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,z(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-T&&(z(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===g?(z(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(z(e,!1),e.strm.avail_out),1)})),new $(4,4,8,4,V),new $(4,5,16,8,V),new $(4,6,32,32,V),new $(4,4,16,16,j),new $(8,16,32,32,j),new $(8,16,128,128,j),new $(8,32,128,256,j),new $(32,128,258,1024,j),new $(32,258,258,4096,j)];function G(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),O(this.dyn_ltree),O(this.dyn_dtree),O(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),O(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),O(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Y=e=>{if(!e||!e.state)return U(e,v);e.total_in=e.total_out=0,e.data_type=R;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:H,e.adler=2===t.wrap?0:1,t.last_flush=h,n(t),f},X=e=>{const t=Y(e);var i;return t===f&&((i=e.state).window_size=2*i.w_size,O(i.head),i.max_lazy_match=W[i.level].max_lazy,i.good_match=W[i.level].good_length,i.nice_match=W[i.level].nice_length,i.max_chain_length=W[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},J=(e,t,i,n,a,s)=>{if(!e)return v;let o=1;if(t===A&&(t=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),a<1||a>9||i!==I||n<8||n>15||t<0||t>9||s<0||s>x)return U(e,v);8===n&&(n=9);const r=new G;return e.state=r,r.strm=e,r.wrap=o,r.gzhead=null,r.w_bits=n,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=a+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Uint8Array(2*r.w_size),r.head=new Uint16Array(r.hash_size),r.prev=new Uint16Array(r.w_size),r.lit_bufsize=1<<a+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Uint8Array(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=t,r.strategy=s,r.method=i,X(e)};e.exports.deflateInit=(e,t)=>J(e,t,I,15,8,D),e.exports.deflateInit2=J,e.exports.deflateReset=X,e.exports.deflateResetKeep=Y,e.exports.deflateSetHeader=(e,t)=>e&&e.state?2!==e.state.wrap?v:(e.state.gzhead=t,f):v,e.exports.deflate=(e,t)=>{let i,n;if(!e||!e.state||t>m||t<0)return e?U(e,v):v;const s=e.state;if(!e.output||!e.input&&0!==e.avail_in||s.status===E&&t!==g)return U(e,0===e.avail_out?b:v);s.strm=e;const l=s.last_flush;if(s.last_flush=t,42===s.status)if(2===s.wrap)e.adler=0,M(s,31),M(s,139),M(s,8),s.gzhead?(M(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),M(s,255&s.gzhead.time),M(s,s.gzhead.time>>8&255),M(s,s.gzhead.time>>16&255),M(s,s.gzhead.time>>24&255),M(s,9===s.level?2:s.strategy>=C||s.level<2?4:0),M(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(M(s,255&s.gzhead.extra.length),M(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=d(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69):(M(s,0),M(s,0),M(s,0),M(s,0),M(s,0),M(s,9===s.level?2:s.strategy>=C||s.level<2?4:0),M(s,3),s.status=H);else{let t=I+(s.w_bits-8<<4)<<8,i=-1;i=s.strategy>=C||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=i<<6,0!==s.strstart&&(t|=32),t+=31-t%31,s.status=H,Z(s,t),0!==s.strstart&&(Z(s,e.adler>>>16),Z(s,65535&e.adler)),e.adler=1}if(69===s.status)if(s.gzhead.extra){for(i=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>i&&(e.adler=d(e.adler,s.pending_buf,s.pending-i,i)),N(e),i=s.pending,s.pending!==s.pending_buf_size));)M(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>i&&(e.adler=d(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=73)}else s.status=73;if(73===s.status)if(s.gzhead.name){i=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>i&&(e.adler=d(e.adler,s.pending_buf,s.pending-i,i)),N(e),i=s.pending,s.pending===s.pending_buf_size)){n=1;break}n=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,M(s,n)}while(0!==n);s.gzhead.hcrc&&s.pending>i&&(e.adler=d(e.adler,s.pending_buf,s.pending-i,i)),0===n&&(s.gzindex=0,s.status=91)}else s.status=91;if(91===s.status)if(s.gzhead.comment){i=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>i&&(e.adler=d(e.adler,s.pending_buf,s.pending-i,i)),N(e),i=s.pending,s.pending===s.pending_buf_size)){n=1;break}n=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,M(s,n)}while(0!==n);s.gzhead.hcrc&&s.pending>i&&(e.adler=d(e.adler,s.pending_buf,s.pending-i,i)),0===n&&(s.status=F)}else s.status=F;if(s.status===F&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&N(e),s.pending+2<=s.pending_buf_size&&(M(s,255&e.adler),M(s,e.adler>>8&255),e.adler=0,s.status=H)):s.status=H),0!==s.pending){if(N(e),0===e.avail_out)return s.last_flush=-1,f}else if(0===e.avail_in&&P(t)<=P(l)&&t!==g)return U(e,b);if(s.status===E&&0!==e.avail_in)return U(e,b);if(0!==e.avail_in||0!==s.lookahead||t!==h&&s.status!==E){let i=s.strategy===C?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(K(e),0===e.lookahead)){if(t===h)return 1;break}if(e.match_length=0,i=o(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(z(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===g?(z(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(z(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===y?((e,t)=>{let i,n,a,s;const r=e.window;for(;;){if(e.lookahead<=k){if(K(e),e.lookahead<=k&&t===h)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,n=r[a],n===r[++a]&&n===r[++a]&&n===r[++a])){s=e.strstart+k;do{}while(n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&n===r[++a]&&a<s);e.match_length=k-(s-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=o(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=o(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(z(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===g?(z(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(z(e,!1),0===e.strm.avail_out)?1:2})(s,t):W[s.level].func(s,t);if(3!==i&&4!==i||(s.status=E),1===i||3===i)return 0===e.avail_out&&(s.last_flush=-1),f;if(2===i&&(t===c?r(s):t!==m&&(a(s,0,0,!1),t===_&&(O(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),N(e),0===e.avail_out))return s.last_flush=-1,f}return t!==g?f:s.wrap<=0?p:(2===s.wrap?(M(s,255&e.adler),M(s,e.adler>>8&255),M(s,e.adler>>16&255),M(s,e.adler>>24&255),M(s,255&e.total_in),M(s,e.total_in>>8&255),M(s,e.total_in>>16&255),M(s,e.total_in>>24&255)):(Z(s,e.adler>>>16),Z(s,65535&e.adler)),N(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?f:p)},e.exports.deflateEnd=e=>{if(!e||!e.state)return v;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==F&&t!==H&&t!==E?U(e,v):(e.state=null,t===H?U(e,S):f)},e.exports.deflateSetDictionary=(e,t)=>{let i=t.length;if(!e||!e.state)return v;const n=e.state,a=n.wrap;if(2===a||1===a&&42!==n.status||n.lookahead)return v;if(1===a&&(e.adler=l(e.adler,t,i,0)),n.wrap=0,i>=n.w_size){0===a&&(O(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(i-n.w_size,i),0),t=e,i=n.w_size}const s=e.avail_in,o=e.next_in,r=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,K(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=L(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,K(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=o,e.input=r,e.avail_in=s,n.wrap=a,f},e.exports.deflateInfo="pako deflate (from Nodeca project)"},401:e=>{"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},264:e=>{"use strict";e.exports=function(e,t){let i,n,a,s,o,r,l,d,u,h,c,_,g,m,f,p,v,S,b,A,w,C,y,x;const D=e.state;i=e.next_in,y=e.input,n=i+(e.avail_in-5),a=e.next_out,x=e.output,s=a-(t-e.avail_out),o=a+(e.avail_out-257),r=D.dmax,l=D.wsize,d=D.whave,u=D.wnext,h=D.window,c=D.hold,_=D.bits,g=D.lencode,m=D.distcode,f=(1<<D.lenbits)-1,p=(1<<D.distbits)-1;e:do{_<15&&(c+=y[i++]<<_,_+=8,c+=y[i++]<<_,_+=8),v=g[c&f];t:for(;;){if(S=v>>>24,c>>>=S,_-=S,S=v>>>16&255,0===S)x[a++]=65535&v;else{if(!(16&S)){if(0==(64&S)){v=g[(65535&v)+(c&(1<<S)-1)];continue t}if(32&S){D.mode=12;break e}e.msg="invalid literal/length code",D.mode=30;break e}b=65535&v,S&=15,S&&(_<S&&(c+=y[i++]<<_,_+=8),b+=c&(1<<S)-1,c>>>=S,_-=S),_<15&&(c+=y[i++]<<_,_+=8,c+=y[i++]<<_,_+=8),v=m[c&p];i:for(;;){if(S=v>>>24,c>>>=S,_-=S,S=v>>>16&255,!(16&S)){if(0==(64&S)){v=m[(65535&v)+(c&(1<<S)-1)];continue i}e.msg="invalid distance code",D.mode=30;break e}if(A=65535&v,S&=15,_<S&&(c+=y[i++]<<_,_+=8,_<S&&(c+=y[i++]<<_,_+=8)),A+=c&(1<<S)-1,A>r){e.msg="invalid distance too far back",D.mode=30;break e}if(c>>>=S,_-=S,S=a-s,A>S){if(S=A-S,S>d&&D.sane){e.msg="invalid distance too far back",D.mode=30;break e}if(w=0,C=h,0===u){if(w+=l-S,S<b){b-=S;do{x[a++]=h[w++]}while(--S);w=a-A,C=x}}else if(u<S){if(w+=l+u-S,S-=u,S<b){b-=S;do{x[a++]=h[w++]}while(--S);if(w=0,u<b){S=u,b-=S;do{x[a++]=h[w++]}while(--S);w=a-A,C=x}}}else if(w+=u-S,S<b){b-=S;do{x[a++]=h[w++]}while(--S);w=a-A,C=x}for(;b>2;)x[a++]=C[w++],x[a++]=C[w++],x[a++]=C[w++],b-=3;b&&(x[a++]=C[w++],b>1&&(x[a++]=C[w++]))}else{w=a-A;do{x[a++]=x[w++],x[a++]=x[w++],x[a++]=x[w++],b-=3}while(b>2);b&&(x[a++]=x[w++],b>1&&(x[a++]=x[w++]))}break}}break}}while(i<n&&a<o);b=_>>3,i-=b,_-=b<<3,c&=(1<<_)-1,e.next_in=i,e.next_out=a,e.avail_in=i<n?n-i+5:5-(i-n),e.avail_out=a<o?o-a+257:257-(a-o),D.hold=c,D.bits=_}},948:(e,t,i)=>{"use strict";const n=i(69),a=i(869),s=i(264),o=i(241),{Z_FINISH:r,Z_BLOCK:l,Z_TREES:d,Z_OK:u,Z_STREAM_END:h,Z_NEED_DICT:c,Z_STREAM_ERROR:_,Z_DATA_ERROR:g,Z_MEM_ERROR:m,Z_BUF_ERROR:f,Z_DEFLATED:p}=i(619),v=12,S=30,b=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const w=e=>{if(!e||!e.state)return _;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,u},C=e=>{if(!e||!e.state)return _;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,w(e)},y=(e,t)=>{let i;if(!e||!e.state)return _;const n=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,C(e))},x=(e,t)=>{if(!e)return _;const i=new A;e.state=i,i.window=null;const n=y(e,t);return n!==u&&(e.state=null),n};let D,R,I=!0;const k=e=>{if(I){D=new Int32Array(512),R=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,D,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,R,0,e.work,{bits:5}),I=!1}e.lencode=D,e.lenbits=9,e.distcode=R,e.distbits=5},T=(e,t,i,n)=>{let a;const s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(t.subarray(i-s.wsize,i),0),s.wnext=0,s.whave=s.wsize):(a=s.wsize-s.wnext,a>n&&(a=n),s.window.set(t.subarray(i-n,i-n+a),s.wnext),(n-=a)?(s.window.set(t.subarray(i-n,i),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=a,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=a))),0};e.exports.inflateReset=C,e.exports.inflateReset2=y,e.exports.inflateResetKeep=w,e.exports.inflateInit=e=>x(e,15),e.exports.inflateInit2=x,e.exports.inflate=(e,t)=>{let i,A,w,C,y,x,D,R,I,F,H,E,U,P,O,L,N,z,M,Z,Q,B,K=0;const V=new Uint8Array(4);let j,$;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return _;i=e.state,i.mode===v&&(i.mode=13),y=e.next_out,w=e.output,D=e.avail_out,C=e.next_in,A=e.input,x=e.avail_in,R=i.hold,I=i.bits,F=x,H=D,B=u;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;I<16;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(2&i.wrap&&35615===R){i.check=0,V[0]=255&R,V[1]=R>>>8&255,i.check=a(i.check,V,2,0),R=0,I=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&R)<<8)+(R>>8))%31){e.msg="incorrect header check",i.mode=S;break}if((15&R)!==p){e.msg="unknown compression method",i.mode=S;break}if(R>>>=4,I-=4,Q=8+(15&R),0===i.wbits)i.wbits=Q;else if(Q>i.wbits){e.msg="invalid window size",i.mode=S;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&R?10:v,R=0,I=0;break;case 2:for(;I<16;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(i.flags=R,(255&i.flags)!==p){e.msg="unknown compression method",i.mode=S;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=S;break}i.head&&(i.head.text=R>>8&1),512&i.flags&&(V[0]=255&R,V[1]=R>>>8&255,i.check=a(i.check,V,2,0)),R=0,I=0,i.mode=3;case 3:for(;I<32;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}i.head&&(i.head.time=R),512&i.flags&&(V[0]=255&R,V[1]=R>>>8&255,V[2]=R>>>16&255,V[3]=R>>>24&255,i.check=a(i.check,V,4,0)),R=0,I=0,i.mode=4;case 4:for(;I<16;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}i.head&&(i.head.xflags=255&R,i.head.os=R>>8),512&i.flags&&(V[0]=255&R,V[1]=R>>>8&255,i.check=a(i.check,V,2,0)),R=0,I=0,i.mode=5;case 5:if(1024&i.flags){for(;I<16;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}i.length=R,i.head&&(i.head.extra_len=R),512&i.flags&&(V[0]=255&R,V[1]=R>>>8&255,i.check=a(i.check,V,2,0)),R=0,I=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(E=i.length,E>x&&(E=x),E&&(i.head&&(Q=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(A.subarray(C,C+E),Q)),512&i.flags&&(i.check=a(i.check,A,E,C)),x-=E,C+=E,i.length-=E),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===x)break e;E=0;do{Q=A[C+E++],i.head&&Q&&i.length<65536&&(i.head.name+=String.fromCharCode(Q))}while(Q&&E<x);if(512&i.flags&&(i.check=a(i.check,A,E,C)),x-=E,C+=E,Q)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===x)break e;E=0;do{Q=A[C+E++],i.head&&Q&&i.length<65536&&(i.head.comment+=String.fromCharCode(Q))}while(Q&&E<x);if(512&i.flags&&(i.check=a(i.check,A,E,C)),x-=E,C+=E,Q)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;I<16;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(R!==(65535&i.check)){e.msg="header crc mismatch",i.mode=S;break}R=0,I=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=v;break;case 10:for(;I<32;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}e.adler=i.check=b(R),R=0,I=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=y,e.avail_out=D,e.next_in=C,e.avail_in=x,i.hold=R,i.bits=I,c;e.adler=i.check=1,i.mode=v;case v:if(t===l||t===d)break e;case 13:if(i.last){R>>>=7&I,I-=7&I,i.mode=27;break}for(;I<3;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}switch(i.last=1&R,R>>>=1,I-=1,3&R){case 0:i.mode=14;break;case 1:if(k(i),i.mode=20,t===d){R>>>=2,I-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=S}R>>>=2,I-=2;break;case 14:for(R>>>=7&I,I-=7&I;I<32;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if((65535&R)!=(R>>>16^65535)){e.msg="invalid stored block lengths",i.mode=S;break}if(i.length=65535&R,R=0,I=0,i.mode=15,t===d)break e;case 15:i.mode=16;case 16:if(E=i.length,E){if(E>x&&(E=x),E>D&&(E=D),0===E)break e;w.set(A.subarray(C,C+E),y),x-=E,C+=E,D-=E,y+=E,i.length-=E;break}i.mode=v;break;case 17:for(;I<14;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(i.nlen=257+(31&R),R>>>=5,I-=5,i.ndist=1+(31&R),R>>>=5,I-=5,i.ncode=4+(15&R),R>>>=4,I-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=S;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;I<3;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}i.lens[W[i.have++]]=7&R,R>>>=3,I-=3}for(;i.have<19;)i.lens[W[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,j={bits:i.lenbits},B=o(0,i.lens,0,19,i.lencode,0,i.work,j),i.lenbits=j.bits,B){e.msg="invalid code lengths set",i.mode=S;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;K=i.lencode[R&(1<<i.lenbits)-1],O=K>>>24,L=K>>>16&255,N=65535&K,!(O<=I);){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(N<16)R>>>=O,I-=O,i.lens[i.have++]=N;else{if(16===N){for($=O+2;I<$;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(R>>>=O,I-=O,0===i.have){e.msg="invalid bit length repeat",i.mode=S;break}Q=i.lens[i.have-1],E=3+(3&R),R>>>=2,I-=2}else if(17===N){for($=O+3;I<$;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}R>>>=O,I-=O,Q=0,E=3+(7&R),R>>>=3,I-=3}else{for($=O+7;I<$;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}R>>>=O,I-=O,Q=0,E=11+(127&R),R>>>=7,I-=7}if(i.have+E>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=S;break}for(;E--;)i.lens[i.have++]=Q}}if(i.mode===S)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=S;break}if(i.lenbits=9,j={bits:i.lenbits},B=o(1,i.lens,0,i.nlen,i.lencode,0,i.work,j),i.lenbits=j.bits,B){e.msg="invalid literal/lengths set",i.mode=S;break}if(i.distbits=6,i.distcode=i.distdyn,j={bits:i.distbits},B=o(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,j),i.distbits=j.bits,B){e.msg="invalid distances set",i.mode=S;break}if(i.mode=20,t===d)break e;case 20:i.mode=21;case 21:if(x>=6&&D>=258){e.next_out=y,e.avail_out=D,e.next_in=C,e.avail_in=x,i.hold=R,i.bits=I,s(e,H),y=e.next_out,w=e.output,D=e.avail_out,C=e.next_in,A=e.input,x=e.avail_in,R=i.hold,I=i.bits,i.mode===v&&(i.back=-1);break}for(i.back=0;K=i.lencode[R&(1<<i.lenbits)-1],O=K>>>24,L=K>>>16&255,N=65535&K,!(O<=I);){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(L&&0==(240&L)){for(z=O,M=L,Z=N;K=i.lencode[Z+((R&(1<<z+M)-1)>>z)],O=K>>>24,L=K>>>16&255,N=65535&K,!(z+O<=I);){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}R>>>=z,I-=z,i.back+=z}if(R>>>=O,I-=O,i.back+=O,i.length=N,0===L){i.mode=26;break}if(32&L){i.back=-1,i.mode=v;break}if(64&L){e.msg="invalid literal/length code",i.mode=S;break}i.extra=15&L,i.mode=22;case 22:if(i.extra){for($=i.extra;I<$;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}i.length+=R&(1<<i.extra)-1,R>>>=i.extra,I-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;K=i.distcode[R&(1<<i.distbits)-1],O=K>>>24,L=K>>>16&255,N=65535&K,!(O<=I);){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(0==(240&L)){for(z=O,M=L,Z=N;K=i.distcode[Z+((R&(1<<z+M)-1)>>z)],O=K>>>24,L=K>>>16&255,N=65535&K,!(z+O<=I);){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}R>>>=z,I-=z,i.back+=z}if(R>>>=O,I-=O,i.back+=O,64&L){e.msg="invalid distance code",i.mode=S;break}i.offset=N,i.extra=15&L,i.mode=24;case 24:if(i.extra){for($=i.extra;I<$;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}i.offset+=R&(1<<i.extra)-1,R>>>=i.extra,I-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=S;break}i.mode=25;case 25:if(0===D)break e;if(E=H-D,i.offset>E){if(E=i.offset-E,E>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=S;break}E>i.wnext?(E-=i.wnext,U=i.wsize-E):U=i.wnext-E,E>i.length&&(E=i.length),P=i.window}else P=w,U=y-i.offset,E=i.length;E>D&&(E=D),D-=E,i.length-=E;do{w[y++]=P[U++]}while(--E);0===i.length&&(i.mode=21);break;case 26:if(0===D)break e;w[y++]=i.length,D--,i.mode=21;break;case 27:if(i.wrap){for(;I<32;){if(0===x)break e;x--,R|=A[C++]<<I,I+=8}if(H-=D,e.total_out+=H,i.total+=H,H&&(e.adler=i.check=i.flags?a(i.check,w,H,y-H):n(i.check,w,H,y-H)),H=D,(i.flags?R:b(R))!==i.check){e.msg="incorrect data check",i.mode=S;break}R=0,I=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;I<32;){if(0===x)break e;x--,R+=A[C++]<<I,I+=8}if(R!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=S;break}R=0,I=0}i.mode=29;case 29:B=h;break e;case S:B=g;break e;case 31:return m;case 32:default:return _}return e.next_out=y,e.avail_out=D,e.next_in=C,e.avail_in=x,i.hold=R,i.bits=I,(i.wsize||H!==e.avail_out&&i.mode<S&&(i.mode<27||t!==r))&&T(e,e.output,e.next_out,H-e.avail_out)?(i.mode=31,m):(F-=e.avail_in,H-=e.avail_out,e.total_in+=F,e.total_out+=H,i.total+=H,i.wrap&&H&&(e.adler=i.check=i.flags?a(i.check,w,H,e.next_out-H):n(i.check,w,H,e.next_out-H)),e.data_type=i.bits+(i.last?64:0)+(i.mode===v?128:0)+(20===i.mode||15===i.mode?256:0),(0===F&&0===H||t===r)&&B===u&&(B=f),B)},e.exports.inflateEnd=e=>{if(!e||!e.state)return _;let t=e.state;return t.window&&(t.window=null),e.state=null,u},e.exports.inflateGetHeader=(e,t)=>{if(!e||!e.state)return _;const i=e.state;return 0==(2&i.wrap)?_:(i.head=t,t.done=!1,u)},e.exports.inflateSetDictionary=(e,t)=>{const i=t.length;let a,s,o;return e&&e.state?(a=e.state,0!==a.wrap&&11!==a.mode?_:11===a.mode&&(s=1,s=n(s,t,i,0),s!==a.check)?g:(o=T(e,t,i,i),o?(a.mode=31,m):(a.havedict=1,u))):_},e.exports.inflateInfo="pako inflate (from Nodeca project)"},241:e=>{"use strict";const t=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),i=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),n=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),a=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);e.exports=(e,s,o,r,l,d,u,h)=>{const c=h.bits;let _,g,m,f,p,v,S=0,b=0,A=0,w=0,C=0,y=0,x=0,D=0,R=0,I=0,k=null,T=0;const F=new Uint16Array(16),H=new Uint16Array(16);let E,U,P,O=null,L=0;for(S=0;S<=15;S++)F[S]=0;for(b=0;b<r;b++)F[s[o+b]]++;for(C=c,w=15;w>=1&&0===F[w];w--);if(C>w&&(C=w),0===w)return l[d++]=20971520,l[d++]=20971520,h.bits=1,0;for(A=1;A<w&&0===F[A];A++);for(C<A&&(C=A),D=1,S=1;S<=15;S++)if(D<<=1,D-=F[S],D<0)return-1;if(D>0&&(0===e||1!==w))return-1;for(H[1]=0,S=1;S<15;S++)H[S+1]=H[S]+F[S];for(b=0;b<r;b++)0!==s[o+b]&&(u[H[s[o+b]]++]=b);if(0===e?(k=O=u,v=19):1===e?(k=t,T-=257,O=i,L-=257,v=256):(k=n,O=a,v=-1),I=0,b=0,S=A,p=d,y=C,x=0,m=-1,R=1<<C,f=R-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){E=S-x,u[b]<v?(U=0,P=u[b]):u[b]>v?(U=O[L+u[b]],P=k[T+u[b]]):(U=96,P=0),_=1<<S-x,g=1<<y,A=g;do{g-=_,l[p+(I>>x)+g]=E<<24|U<<16|P|0}while(0!==g);for(_=1<<S-1;I&_;)_>>=1;if(0!==_?(I&=_-1,I+=_):I=0,b++,0==--F[S]){if(S===w)break;S=s[o+u[b]]}if(S>C&&(I&f)!==m){for(0===x&&(x=C),p+=A,y=S-x,D=1<<y;y+x<w&&(D-=F[y+x],!(D<=0));)y++,D<<=1;if(R+=1<<y,1===e&&R>852||2===e&&R>592)return 1;m=I&f,l[m]=C<<24|y<<16|p-d|0}}return 0!==I&&(l[p+I]=S-x<<24|64<<16|0),h.bits=C,0}},898:e=>{"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},342:e=>{"use strict";function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const i=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),a=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=new Array(576);t(o);const r=new Array(60);t(r);const l=new Array(512);t(l);const d=new Array(256);t(d);const u=new Array(29);t(u);const h=new Array(30);function c(e,t,i,n,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=a,this.has_stree=e&&e.length}let _,g,m;function f(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(h);const p=e=>e<256?l[e]:l[256+(e>>>7)],v=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},S=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,v(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},b=(e,t,i)=>{S(e,i[2*t],i[2*t+1])},A=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},w=(e,t,i)=>{const n=new Array(16);let a,s,o=0;for(a=1;a<=15;a++)n[a]=o=o+i[a-1]<<1;for(s=0;s<=t;s++){let t=e[2*s+1];0!==t&&(e[2*s]=A(n[t]++,t))}},C=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},y=e=>{e.bi_valid>8?v(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},x=(e,t,i,n)=>{const a=2*t,s=2*i;return e[a]<e[s]||e[a]===e[s]&&n[t]<=n[i]},D=(e,t,i)=>{const n=e.heap[i];let a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&x(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!x(t,n,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=n},R=(e,t,a)=>{let s,o,r,l,c=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],o=e.pending_buf[e.l_buf+c],c++,0===s?b(e,o,t):(r=d[o],b(e,r+256+1,t),l=i[r],0!==l&&(o-=u[r],S(e,o,l)),s--,r=p(s),b(e,r,a),l=n[r],0!==l&&(s-=h[r],S(e,s,l)))}while(c<e.last_lit);b(e,256,t)},I=(e,t)=>{const i=t.dyn_tree,n=t.stat_desc.static_tree,a=t.stat_desc.has_stree,s=t.stat_desc.elems;let o,r,l,d=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<s;o++)0!==i[2*o]?(e.heap[++e.heap_len]=d=o,e.depth[o]=0):i[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=d<2?++d:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=n[2*l+1]);for(t.max_code=d,o=e.heap_len>>1;o>=1;o--)D(e,i,o);l=s;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],D(e,i,1),r=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=r,i[2*l]=i[2*o]+i[2*r],e.depth[l]=(e.depth[o]>=e.depth[r]?e.depth[o]:e.depth[r])+1,i[2*o+1]=i[2*r+1]=l,e.heap[1]=l++,D(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,n=t.max_code,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,r=t.stat_desc.extra_base,l=t.stat_desc.max_length;let d,u,h,c,_,g,m=0;for(c=0;c<=15;c++)e.bl_count[c]=0;for(i[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)u=e.heap[d],c=i[2*i[2*u+1]+1]+1,c>l&&(c=l,m++),i[2*u+1]=c,u>n||(e.bl_count[c]++,_=0,u>=r&&(_=o[u-r]),g=i[2*u],e.opt_len+=g*(c+_),s&&(e.static_len+=g*(a[2*u+1]+_)));if(0!==m){do{for(c=l-1;0===e.bl_count[c];)c--;e.bl_count[c]--,e.bl_count[c+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(c=l;0!==c;c--)for(u=e.bl_count[c];0!==u;)h=e.heap[--d],h>n||(i[2*h+1]!==c&&(e.opt_len+=(c-i[2*h+1])*i[2*h],i[2*h+1]=c),u--)}})(e,t),w(i,d,e.bl_count)},k=(e,t,i)=>{let n,a,s=-1,o=t[1],r=0,l=7,d=4;for(0===o&&(l=138,d=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)a=o,o=t[2*(n+1)+1],++r<l&&a===o||(r<d?e.bl_tree[2*a]+=r:0!==a?(a!==s&&e.bl_tree[2*a]++,e.bl_tree[32]++):r<=10?e.bl_tree[34]++:e.bl_tree[36]++,r=0,s=a,0===o?(l=138,d=3):a===o?(l=6,d=3):(l=7,d=4))},T=(e,t,i)=>{let n,a,s=-1,o=t[1],r=0,l=7,d=4;for(0===o&&(l=138,d=3),n=0;n<=i;n++)if(a=o,o=t[2*(n+1)+1],!(++r<l&&a===o)){if(r<d)do{b(e,a,e.bl_tree)}while(0!=--r);else 0!==a?(a!==s&&(b(e,a,e.bl_tree),r--),b(e,16,e.bl_tree),S(e,r-3,2)):r<=10?(b(e,17,e.bl_tree),S(e,r-3,3)):(b(e,18,e.bl_tree),S(e,r-11,7));r=0,s=a,0===o?(l=138,d=3):a===o?(l=6,d=3):(l=7,d=4)}};let F=!1;const H=(e,t,i,n)=>{S(e,0+(n?1:0),3),((e,t,i,n)=>{y(e),v(e,i),v(e,~i),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i})(e,t,i)};e.exports._tr_init=e=>{F||((()=>{let e,t,s,f,p;const v=new Array(16);for(s=0,f=0;f<28;f++)for(u[f]=s,e=0;e<1<<i[f];e++)d[s++]=f;for(d[s-1]=f,p=0,f=0;f<16;f++)for(h[f]=p,e=0;e<1<<n[f];e++)l[p++]=f;for(p>>=7;f<30;f++)for(h[f]=p<<7,e=0;e<1<<n[f]-7;e++)l[256+p++]=f;for(t=0;t<=15;t++)v[t]=0;for(e=0;e<=143;)o[2*e+1]=8,e++,v[8]++;for(;e<=255;)o[2*e+1]=9,e++,v[9]++;for(;e<=279;)o[2*e+1]=7,e++,v[7]++;for(;e<=287;)o[2*e+1]=8,e++,v[8]++;for(w(o,287,v),e=0;e<30;e++)r[2*e+1]=5,r[2*e]=A(e,5);_=new c(o,i,257,286,15),g=new c(r,n,0,30,15),m=new c(new Array(0),a,0,19,7)})(),F=!0),e.l_desc=new f(e.dyn_ltree,_),e.d_desc=new f(e.dyn_dtree,g),e.bl_desc=new f(e.bl_tree,m),e.bi_buf=0,e.bi_valid=0,C(e)},e.exports._tr_stored_block=H,e.exports._tr_flush_block=(e,t,i,n)=>{let a,l,d=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),I(e,e.l_desc),I(e,e.d_desc),d=(e=>{let t;for(k(e,e.dyn_ltree,e.l_desc.max_code),k(e,e.dyn_dtree,e.d_desc.max_code),I(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*s[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=a&&(a=l)):a=l=i+5,i+4<=a&&-1!==t?H(e,t,i,n):4===e.strategy||l===a?(S(e,2+(n?1:0),3),R(e,o,r)):(S(e,4+(n?1:0),3),((e,t,i,n)=>{let a;for(S(e,t-257,5),S(e,i-1,5),S(e,n-4,4),a=0;a<n;a++)S(e,e.bl_tree[2*s[a]+1],3);T(e,e.dyn_ltree,t-1),T(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),R(e,e.dyn_ltree,e.dyn_dtree)),C(e),n&&y(e)},e.exports._tr_tally=(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(d[i]+256+1)]++,e.dyn_dtree[2*p(t)]++),e.last_lit===e.lit_bufsize-1),e.exports._tr_align=e=>{S(e,2,3),b(e,256,o),(e=>{16===e.bi_valid?(v(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},292:e=>{"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},441:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReceivedHiFiAudioAPIData=t.HiFiAudioAPIData=t.OrientationQuat3D=t.OrientationEuler3D=t.Point3D=void 0;const n=i(24);class a{constructor({x:e=null,y:t=null,z:i=null}={}){this.x=e,this.y=t,this.z=i}}t.Point3D=a;class s{constructor({pitchDegrees:e=0,yawDegrees:t=0,rollDegrees:i=0}={}){this.pitchDegrees=e,this.yawDegrees=t,this.rollDegrees=i}}t.OrientationEuler3D=s;class o{constructor({w:e=1,x:t=0,y:i=0,z:n=0}={}){this.w=e,this.x=t,this.y=i,this.z=n}}t.OrientationQuat3D=o;class r{constructor({position:e=null,orientationEuler:t=null,orientationQuat:i=null,volumeThreshold:n=null,hiFiGain:a=null,userAttenuation:s=null,userRolloff:o=null}={}){this.position=e,this.orientationQuat=i,this.orientationEuler=t,this.volumeThreshold=n,this.hiFiGain=a,this.userAttenuation=s,this.userRolloff=o}diff(e){let t={position:Object.assign({},this.position),orientationEuler:Object.assign({},this.orientationEuler),orientationQuat:Object.assign({},this.orientationQuat)};"number"==typeof this.volumeThreshold&&(t.volumeThreshold=this.volumeThreshold),"number"==typeof this.hiFiGain&&(t.hiFiGain=this.hiFiGain),"number"==typeof this.userAttenuation&&(t.userAttenuation=this.userAttenuation),"number"==typeof this.userRolloff&&(t.userRolloff=this.userRolloff);let i={position:Object.assign({},e.position),orientationEuler:Object.assign({},e.orientationEuler),orientationQuat:Object.assign({},e.orientationQuat)};"number"==typeof e.volumeThreshold&&(i.volumeThreshold=e.volumeThreshold),"number"==typeof e.hiFiGain&&(i.hiFiGain=e.hiFiGain),"number"==typeof e.userAttenuation&&(i.userAttenuation=e.userAttenuation),"number"==typeof e.userRolloff&&(i.userRolloff=e.userRolloff);let l=n.recursivelyDiffObjects(t,i),d=new r;return!l.position||"number"!=typeof l.position.x&&"number"!=typeof l.position.y&&"number"!=typeof l.position.z||(d.position=new a(e.position)),!l.orientationEuler||"number"!=typeof l.orientationEuler.pitchDegrees&&"number"!=typeof l.orientationEuler.yawDegrees&&"number"!=typeof l.orientationEuler.rollDegrees||(d.orientationEuler=new s(l.orientationEuler)),!l.orientationQuat||"number"!=typeof l.orientationQuat.w&&"number"!=typeof l.orientationQuat.x&&"number"!=typeof l.orientationQuat.y&&"number"!=typeof l.orientationQuat.z||(d.orientationQuat=new o(l.orientationQuat)),"number"==typeof l.volumeThreshold&&(d.volumeThreshold=l.volumeThreshold),"number"==typeof l.hiFiGain&&(d.hiFiGain=l.hiFiGain),"number"==typeof l.userAttenuation&&(d.userAttenuation=l.userAttenuation),"number"==typeof l.userRolloff&&(d.userRolloff=l.userRolloff),d}}t.HiFiAudioAPIData=r,t.ReceivedHiFiAudioAPIData=class extends r{constructor(e={}){super(e),this.providedUserID=e.providedUserID,this.hashedVisitID=e.hashedVisitID,this.volumeDecibels=e.volumeDecibels}}},641:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HiFiAxisUtilities=t.ourHiFiAxisConfiguration=t.HiFiAxisConfiguration=t.HiFiHandedness=t.HiFiAxes=void 0;const n=i(649),a=i(441);var s,o;!function(e){e.PositiveX="Positive X",e.NegativeX="Negative X",e.PositiveY="Positive Y",e.NegativeY="Negative Y",e.PositiveZ="Positive Z",e.NegativeZ="Negative Z"}(s=t.HiFiAxes||(t.HiFiAxes={})),function(e){e.RightHand="Right Hand",e.LeftHand="Left Hand"}(o=t.HiFiHandedness||(t.HiFiHandedness={}));class r{constructor({rightAxis:e,leftAxis:t,intoScreenAxis:i,outOfScreenAxis:n,upAxis:a,downAxis:s,handedness:o}){Object.assign(this,{rightAxis:e,leftAxis:t,intoScreenAxis:i,outOfScreenAxis:n,upAxis:a,downAxis:s,handedness:o})}}t.HiFiAxisConfiguration=r,t.ourHiFiAxisConfiguration=new r({rightAxis:s.PositiveX,leftAxis:s.NegativeX,intoScreenAxis:s.PositiveY,outOfScreenAxis:s.NegativeY,upAxis:s.PositiveZ,downAxis:s.NegativeZ,handedness:o.RightHand}),t.HiFiAxisUtilities=class{static verify(e){let t=!0;return e.rightAxis===s.PositiveX&&e.leftAxis!==s.NegativeX&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.leftAxis===s.PositiveX&&e.rightAxis!==s.NegativeX&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.rightAxis===s.PositiveY&&e.leftAxis!==s.NegativeY&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.leftAxis===s.PositiveY&&e.rightAxis!==s.NegativeY&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.rightAxis===s.PositiveZ&&e.leftAxis!==s.NegativeZ&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.leftAxis===s.PositiveZ&&e.rightAxis!==s.NegativeZ&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.rightAxis}, and Left Axis is ${e.leftAxis}!`),t=!1),e.intoScreenAxis===s.PositiveX&&e.outOfScreenAxis!==s.NegativeX&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.intoScreenAxis}, and Left Axis is ${e.outOfScreenAxis}!`),t=!1),e.outOfScreenAxis===s.PositiveX&&e.intoScreenAxis!==s.NegativeX&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.intoScreenAxis}, and Left Axis is ${e.outOfScreenAxis}!`),t=!1),e.intoScreenAxis===s.PositiveY&&e.outOfScreenAxis!==s.NegativeY&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.intoScreenAxis}, and Left Axis is ${e.outOfScreenAxis}!`),t=!1),e.outOfScreenAxis===s.PositiveY&&e.intoScreenAxis!==s.NegativeY&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.intoScreenAxis}, and Left Axis is ${e.outOfScreenAxis}!`),t=!1),e.intoScreenAxis===s.PositiveZ&&e.outOfScreenAxis!==s.NegativeZ&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.intoScreenAxis}, and Left Axis is ${e.outOfScreenAxis}!`),t=!1),e.outOfScreenAxis===s.PositiveZ&&e.intoScreenAxis!==s.NegativeZ&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.intoScreenAxis}, and Left Axis is ${e.outOfScreenAxis}!`),t=!1),e.upAxis===s.PositiveX&&e.downAxis!==s.NegativeX&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.upAxis}, and Left Axis is ${e.downAxis}!`),t=!1),e.downAxis===s.PositiveX&&e.upAxis!==s.NegativeX&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.upAxis}, and Left Axis is ${e.downAxis}!`),t=!1),e.upAxis===s.PositiveY&&e.downAxis!==s.NegativeY&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.upAxis}, and Left Axis is ${e.downAxis}!`),t=!1),e.downAxis===s.PositiveY&&e.upAxis!==s.NegativeY&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.upAxis}, and Left Axis is ${e.downAxis}!`),t=!1),e.upAxis===s.PositiveZ&&e.downAxis!==s.NegativeZ&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.upAxis}, and Left Axis is ${e.downAxis}!`),t=!1),e.downAxis===s.PositiveZ&&e.upAxis!==s.NegativeZ&&(n.HiFiLogger.error(`Invalid axis configuration!\nRight Axis is ${e.upAxis}, and Left Axis is ${e.downAxis}!`),t=!1),e.handedness!==o.RightHand&&e.handedness!==o.LeftHand&&(n.HiFiLogger.error(`Invalid axis configuration!\nHandedness is ${e.handedness}!`),t=!1),t}static translatePoint3DToMixerSpace(e,t){let i=new a.Point3D,n="number"==typeof t.x,o="number"==typeof t.y,r="number"==typeof t.z;return e.rightAxis===s.PositiveX&&n?i.x=t.x:e.leftAxis===s.PositiveX&&n?i.x=-t.x:e.intoScreenAxis===s.PositiveX&&o?i.x=t.y:e.outOfScreenAxis===s.PositiveX&&o?i.x=-t.y:e.upAxis===s.PositiveX&&r?i.x=t.z:e.downAxis===s.PositiveX&&r&&(i.x=-t.z),e.rightAxis===s.PositiveY&&n?i.y=t.x:e.leftAxis===s.PositiveY&&n?i.y=-t.x:e.intoScreenAxis===s.PositiveY&&o?i.y=t.y:e.outOfScreenAxis===s.PositiveY&&o?i.y=-t.y:e.upAxis===s.PositiveY&&r?i.y=t.z:e.downAxis===s.PositiveY&&r&&(i.y=-t.z),e.rightAxis===s.PositiveZ&&n?i.z=t.x:e.leftAxis===s.PositiveZ&&n?i.z=-t.x:e.intoScreenAxis===s.PositiveZ&&o?i.z=t.y:e.outOfScreenAxis===s.PositiveZ&&o?i.z=-t.y:e.upAxis===s.PositiveZ&&r?i.z=t.z:e.downAxis===s.PositiveZ&&r&&(i.z=-t.z),i}static translateOrientationEuler3DToMixerSpace(e,t){let i=new a.OrientationEuler3D;return"number"!=typeof t.pitchDegrees&&(t.pitchDegrees=0),"number"!=typeof t.yawDegrees&&(t.yawDegrees=0),"number"!=typeof t.rollDegrees&&(t.rollDegrees=0),e.handedness===o.RightHand?(i.pitchDegrees=t.pitchDegrees,i.yawDegrees=t.yawDegrees,i.rollDegrees=t.rollDegrees):e.handedness===o.LeftHand&&(i.pitchDegrees=t.pitchDegrees,i.yawDegrees=-t.yawDegrees,i.rollDegrees=t.rollDegrees),i}}},468:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HiFiCommunicator=t.HiFiUserDataStreamingScopes=t.HiFiConnectionStates=void 0;const a=i(709),s=i(649),o=i(441),r=i(641),l=i(971),d=i(817);var u,h;(h=t.HiFiConnectionStates||(t.HiFiConnectionStates={})).Connected="Connected",h.Disconnected="Disconnected",h.Failed="Failed",h.Unavailable="Unavailable",function(e){e.None="none",e.Peers="peers",e.All="all"}(u=t.HiFiUserDataStreamingScopes||(t.HiFiUserDataStreamingScopes={})),t.HiFiCommunicator=class{constructor({initialHiFiAudioAPIData:e=new o.HiFiAudioAPIData,onConnectionStateChanged:t,onUsersDisconnected:i,transmitRateLimitTimeoutMS:n=a.HiFiConstants.DEFAULT_TRANSMIT_RATE_LIMIT_TIMEOUT_MS,userDataStreamingScope:d=u.All,hiFiAxisConfiguration:h}={}){this._timers={transmitRateLimitTimeout:null,wantedToTransmitHiFiAudioAPIData:!0},n<a.HiFiConstants.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS&&(s.HiFiLogger.warn(`\`transmitRateLimitTimeoutMS\` must be >= ${a.HiFiConstants.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS}ms! Setting to ${a.HiFiConstants.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS}ms...`),n=a.HiFiConstants.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS),this.transmitRateLimitTimeoutMS=n,i&&(this.onUsersDisconnected=i),this._mixerSession=new l.HiFiMixerSession({userDataStreamingScope:d,onUserDataUpdated:e=>{this._handleUserDataUpdates(e)},onUsersDisconnected:e=>{this._onUsersDisconnected(e)},onConnectionStateChanged:t}),this._inputAudioMediaStream=void 0,this._currentHiFiAudioAPIData=e,this._lastTransmittedHiFiAudioAPIData=new o.HiFiAudioAPIData,this._userDataSubscriptions=[],h&&(r.HiFiAxisUtilities.verify(h)?(r.ourHiFiAxisConfiguration.rightAxis=h.rightAxis,r.ourHiFiAxisConfiguration.leftAxis=h.leftAxis,r.ourHiFiAxisConfiguration.intoScreenAxis=h.intoScreenAxis,r.ourHiFiAxisConfiguration.outOfScreenAxis=h.outOfScreenAxis,r.ourHiFiAxisConfiguration.upAxis=h.upAxis,r.ourHiFiAxisConfiguration.downAxis=h.downAxis,r.ourHiFiAxisConfiguration.handedness=h.handedness):s.HiFiLogger.error("There is an error with the passed `HiFiAxisConfiguration`, so the new axis configuration was not set. There are more error details in the logs above."))}connectToHiFiAudioAPIServer(e,t){return n(this,void 0,void 0,(function*(){if(!this._mixerSession){let e="`this._mixerSession` is falsey!";return Promise.reject({success:!1,error:e})}let i,n;try{n=new URL(t).hostname}catch(e){n=t||a.HiFiConstants.DEFAULT_PROD_HIGH_FIDELITY_ENDPOINT}try{let t=`wss://${n}:8001/?token=`;this._mixerSession.webRTCAddress=`${t}${e}`,s.HiFiLogger.log(`Using WebRTC Signaling Address:\n${t}<token redacted>`),i=yield this._mixerSession.connect()}catch(e){let t=`Error when connecting to mixer! Error:\n${e}`;return Promise.reject({success:!1,error:t})}return this._transmitHiFiAudioAPIDataToServer(!0),Promise.resolve({success:!0,audionetInitResponse:i.audionetInitResponse})}))}disconnectFromHiFiAudioAPIServer(){return n(this,void 0,void 0,(function*(){return this._mixerSession?this._mixerSession.disconnect():Promise.resolve("No mixer session from which we can disconnect!")}))}getOutputAudioMediaStream(){return this._mixerSession?this._mixerSession.getOutputAudioMediaStream():null}setInputAudioMediaStream(e,t=!1){return n(this,void 0,void 0,(function*(){const i=yield this._mixerSession.setRAVIInputAudio(e,t);return i?this._inputAudioMediaStream=e:s.HiFiLogger.warn("Error trying to setRAVIInputAudio on this._mixerSession"),i}))}setInputAudioMuted(e){return n(this,void 0,void 0,(function*(){return this._mixerSession?(s.HiFiLogger.debug(`Setting mute state to : ${e}`),yield this._mixerSession.setInputAudioMuted(e)):(s.HiFiLogger.warn("Couldn't set mute state: No `_mixerSession`."),!1)}))}getCommunicatorInfo(){let e={clientInfo:{inputAudioStreamSet:!!this._inputAudioMediaStream}};return"undefined"!=typeof self&&(e.clientInfo.apiVersion="v0.4.3"),this._mixerSession&&this._mixerSession.mixerInfo&&(e.serverInfo=this._mixerSession.mixerInfo),e}startCollectingWebRTCStats(e){this._mixerSession||s.HiFiLogger.error("Couldn't start collecting WebRTC Stats: No `_mixerSession`!"),this._mixerSession.startCollectingWebRTCStats(e)}stopCollectingWebRTCStats(){this._mixerSession||s.HiFiLogger.error("Couldn't stop collecting WebRTC Stats: No `_mixerSession`!"),this._mixerSession.stopCollectingWebRTCStats()}_updateUserData({position:e,orientationEuler:t,orientationQuat:i,volumeThreshold:n,hiFiGain:a,userAttenuation:s,userRolloff:r}={}){var l,d,u,h,c,_,g,m,f,p;e&&(this._currentHiFiAudioAPIData.position||(this._currentHiFiAudioAPIData.position=new o.Point3D),this._currentHiFiAudioAPIData.position.x=null!==(l=e.x)&&void 0!==l?l:this._currentHiFiAudioAPIData.position.x,this._currentHiFiAudioAPIData.position.y=null!==(d=e.y)&&void 0!==d?d:this._currentHiFiAudioAPIData.position.y,this._currentHiFiAudioAPIData.position.z=null!==(u=e.z)&&void 0!==u?u:this._currentHiFiAudioAPIData.position.z),t&&(this._currentHiFiAudioAPIData.orientationEuler||(this._currentHiFiAudioAPIData.orientationEuler=new o.OrientationEuler3D),this._currentHiFiAudioAPIData.orientationEuler.pitchDegrees=null!==(h=t.pitchDegrees)&&void 0!==h?h:this._currentHiFiAudioAPIData.orientationEuler.pitchDegrees,this._currentHiFiAudioAPIData.orientationEuler.yawDegrees=null!==(c=t.yawDegrees)&&void 0!==c?c:this._currentHiFiAudioAPIData.orientationEuler.yawDegrees,this._currentHiFiAudioAPIData.orientationEuler.rollDegrees=null!==(_=t.rollDegrees)&&void 0!==_?_:this._currentHiFiAudioAPIData.orientationEuler.rollDegrees),i&&(this._currentHiFiAudioAPIData.orientationQuat?(this._currentHiFiAudioAPIData.orientationQuat.w=null!==(g=i.w)&&void 0!==g?g:this._currentHiFiAudioAPIData.orientationQuat.w,this._currentHiFiAudioAPIData.orientationQuat.x=null!==(m=i.x)&&void 0!==m?m:this._currentHiFiAudioAPIData.orientationQuat.x,this._currentHiFiAudioAPIData.orientationQuat.y=null!==(f=i.y)&&void 0!==f?f:this._currentHiFiAudioAPIData.orientationQuat.y,this._currentHiFiAudioAPIData.orientationQuat.z=null!==(p=i.z)&&void 0!==p?p:this._currentHiFiAudioAPIData.orientationQuat.z):this._currentHiFiAudioAPIData.orientationQuat=new o.OrientationQuat3D({w:i.w,x:i.x,y:i.y,z:i.z})),"number"==typeof n&&(this._currentHiFiAudioAPIData.volumeThreshold=n),"number"==typeof a&&(this._currentHiFiAudioAPIData.hiFiGain=Math.max(0,a)),"number"==typeof s&&(this._currentHiFiAudioAPIData.userAttenuation=s),"number"==typeof r&&(this._currentHiFiAudioAPIData.userRolloff=Math.max(0,r))}_maybeClearRateLimitTimeout(){this._timers.transmitRateLimitTimeout&&clearTimeout(this._timers.transmitRateLimitTimeout),this._timers.transmitRateLimitTimeout=null}_updateLastTransmittedHiFiAudioAPIData(e){var t,i,n,a,s,r;e.position&&(this._lastTransmittedHiFiAudioAPIData.position||(this._lastTransmittedHiFiAudioAPIData.position=new o.Point3D),this._lastTransmittedHiFiAudioAPIData.position.x=null!==(t=e.position.x)&&void 0!==t?t:this._lastTransmittedHiFiAudioAPIData.position.x,this._lastTransmittedHiFiAudioAPIData.position.y=null!==(i=e.position.y)&&void 0!==i?i:this._lastTransmittedHiFiAudioAPIData.position.y,this._lastTransmittedHiFiAudioAPIData.position.z=null!==(n=e.position.z)&&void 0!==n?n:this._lastTransmittedHiFiAudioAPIData.position.z),e.orientationEuler&&(this._lastTransmittedHiFiAudioAPIData.orientationEuler||(this._lastTransmittedHiFiAudioAPIData.orientationEuler=new o.OrientationEuler3D),this._lastTransmittedHiFiAudioAPIData.orientationEuler.pitchDegrees=null!==(a=e.orientationEuler.pitchDegrees)&&void 0!==a?a:this._lastTransmittedHiFiAudioAPIData.orientationEuler.pitchDegrees,this._lastTransmittedHiFiAudioAPIData.orientationEuler.yawDegrees=null!==(s=e.orientationEuler.yawDegrees)&&void 0!==s?s:this._lastTransmittedHiFiAudioAPIData.orientationEuler.yawDegrees,this._lastTransmittedHiFiAudioAPIData.orientationEuler.rollDegrees=null!==(r=e.orientationEuler.rollDegrees)&&void 0!==r?r:this._lastTransmittedHiFiAudioAPIData.orientationEuler.rollDegrees),e.orientationQuat&&(this._lastTransmittedHiFiAudioAPIData.orientationQuat?(this._lastTransmittedHiFiAudioAPIData.orientationQuat.w=e.orientationQuat.w,this._lastTransmittedHiFiAudioAPIData.orientationQuat.x=e.orientationQuat.x,this._lastTransmittedHiFiAudioAPIData.orientationQuat.y=e.orientationQuat.y,this._lastTransmittedHiFiAudioAPIData.orientationQuat.z=e.orientationQuat.z):this._lastTransmittedHiFiAudioAPIData.orientationQuat=new o.OrientationQuat3D({w:e.orientationQuat.w,x:e.orientationQuat.x,y:e.orientationQuat.y,z:e.orientationQuat.z})),"number"==typeof e.volumeThreshold&&(this._lastTransmittedHiFiAudioAPIData.volumeThreshold=e.volumeThreshold),"number"==typeof e.hiFiGain&&(this._lastTransmittedHiFiAudioAPIData.hiFiGain=e.hiFiGain),"number"==typeof e.userAttenuation&&(this._lastTransmittedHiFiAudioAPIData.userAttenuation=e.userAttenuation),"number"==typeof e.userRolloff&&(this._lastTransmittedHiFiAudioAPIData.userRolloff=e.userRolloff)}_transmitHiFiAudioAPIDataToServer(e){if(this._mixerSession&&(!this._timers.transmitRateLimitTimeout||e)){this._timers.wantedToTransmitHiFiAudioAPIData=!1,this._maybeClearRateLimitTimeout(),e||(this._timers.transmitRateLimitTimeout=setTimeout((()=>{this._maybeClearRateLimitTimeout(),this._timers.wantedToTransmitHiFiAudioAPIData&&this._transmitHiFiAudioAPIDataToServer(!0)}),this.transmitRateLimitTimeoutMS));let t=this._lastTransmittedHiFiAudioAPIData.diff(this._currentHiFiAudioAPIData),i=this._mixerSession._transmitHiFiAudioAPIDataToServer(t);return i.success?(this._updateLastTransmittedHiFiAudioAPIData(t),{success:!0,rawDataTransmitted:i.stringifiedDataForMixer}):{success:!1,error:i.error}}return this._mixerSession&&this._timers.transmitRateLimitTimeout&&!e?(this._timers.wantedToTransmitHiFiAudioAPIData=!0,{success:!0,error:"Transfer is rate limited. Transfer will occur shortly automatically."}):this._mixerSession?void 0:{success:!1,error:"No server connection yet; can't transmit user data."}}updateUserDataAndTransmit(e){return this._updateUserData(e),this._transmitHiFiAudioAPIDataToServer()}_handleUserDataUpdates(e){if(0!==this._userDataSubscriptions.length)for(let t=0;t<this._userDataSubscriptions.length;t++){let i=this._userDataSubscriptions[t];if(!i.callback)continue;let n=[];for(let t=0;t<e.length;t++){let a=e[t];if(i.providedUserID&&a.providedUserID!==i.providedUserID)continue;let s=new o.ReceivedHiFiAudioAPIData;"string"==typeof a.providedUserID&&(s.providedUserID=a.providedUserID),"string"==typeof a.hashedVisitID&&(s.hashedVisitID=a.hashedVisitID);let r=!1;for(let e=0;e<i.components.length;e++)switch(i.components[e]){case d.AvailableUserDataSubscriptionComponents.Position:a.position&&(s.position=a.position,r=!0);break;case d.AvailableUserDataSubscriptionComponents.OrientationEuler:a.orientationEuler&&(s.orientationEuler=a.orientationEuler,r=!0);break;case d.AvailableUserDataSubscriptionComponents.OrientationQuat:a.orientationQuat&&(s.orientationQuat=a.orientationQuat,r=!0);break;case d.AvailableUserDataSubscriptionComponents.VolumeDecibels:"number"==typeof a.volumeDecibels&&(s.volumeDecibels=a.volumeDecibels,r=!0);break;case d.AvailableUserDataSubscriptionComponents.HiFiGain:"number"==typeof a.hiFiGain&&(s.hiFiGain=a.hiFiGain,r=!0)}r&&n.push(s)}i.callback&&n.length>0&&i.callback(n)}}_onUsersDisconnected(e){this.onUsersDisconnected&&this.onUsersDisconnected(e)}addUserDataSubscription(e){this._mixerSession?this._mixerSession.userDataStreamingScope!==u.None?(s.HiFiLogger.log(`Adding new User Data Subscription:\n${JSON.stringify(e)}`),this._userDataSubscriptions.push(e)):s.HiFiLogger.error("During `HiFiCommunicator` construction, the server was set up to **not** send user data! Data subscription not added."):s.HiFiLogger.error("No `_mixerSession`! Data subscription not added.")}}},971:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.HiFiMixerSession=void 0;const a=i(441),s=i(649),o=i(468),r=i(425),l=i(665),d=i(212),u=i(641),h=i(591);t.HiFiMixerSession=class{constructor({userDataStreamingScope:e=o.HiFiUserDataStreamingScopes.All,onUserDataUpdated:t,onUsersDisconnected:i,onConnectionStateChanged:n}){this.webRTCAddress=void 0,this.userDataStreamingScope=e,this.onUserDataUpdated=t,this.onUsersDisconnected=i,this._mixerPeerKeyToProvidedUserIDDict={},this._mixerPeerKeyToHashedVisitIDDict={},r.RaviUtils.setDebug(!1),this._raviSignalingConnection=new d.RaviSignalingConnection,this._raviSignalingConnection.addStateChangeHandler((e=>{this.onRAVISignalingStateChanged(e)})),this._raviSession=new l.RaviSession,this._raviSession.addStateChangeHandler((e=>{this.onRAVISessionStateChanged(e)})),this.onConnectionStateChanged=n,this._resetMixerInfo()}promiseToRunAudioInit(){return n(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let i={primary:!0,visit_id:this._raviSession.getUUID(),session:this._raviSession.getUUID(),streaming_scope:this.userDataStreamingScope,is_input_stream_stereo:this._inputAudioMediaStreamIsStereo},a=this._raviSession.getCommandController();if(!a)return Promise.reject({success:!1,error:"Couldn't connect to mixer: no `commandController`!"});let s=setTimeout((()=>(this.disconnect(),Promise.reject({success:!1,error:"Couldn't connect to mixer: Call to `init` timed out!"}))),5e3);a.queueCommand("audionet.init",i,(i=>n(this,void 0,void 0,(function*(){let n;clearTimeout(s);try{n=JSON.parse(i),this.mixerInfo.connected=!0,this.mixerInfo.build_number=n.build_number,this.mixerInfo.build_type=n.build_type,this.mixerInfo.build_version=n.build_version,this.mixerInfo.visit_id_hash=n.visit_id_hash,n.unhashedVisitID=this._raviSession.getUUID(),e({success:!0,audionetInitResponse:n})}catch(e){t({success:!1,error:`Couldn't parse init response! Parse error:\n${e}`})}}))))}))}))}handleRAVISessionBinaryData(e){let t=h.ungzip(e,{to:"string"}),i=JSON.parse(t);if(i.deleted_visit_ids){let e=[],t=i.deleted_visit_ids;for(const i of t){let t=i,n=new a.ReceivedHiFiAudioAPIData({hashedVisitID:t}),s=Object.keys(this._mixerPeerKeyToHashedVisitIDDict);for(const e of s)if(this._mixerPeerKeyToHashedVisitIDDict[e]===t){this._mixerPeerKeyToProvidedUserIDDict[e]&&(n.providedUserID=this._mixerPeerKeyToProvidedUserIDDict[e]);break}e.push(n)}this.onUsersDisconnected&&e.length>0&&this.onUsersDisconnected(e)}if(i.peers){let e=[],t=Object.keys(i.peers);for(let n=0;n<t.length;n++){let s=i.peers[t[n]],o=new a.ReceivedHiFiAudioAPIData;this._mixerPeerKeyToProvidedUserIDDict[t[n]]?o.providedUserID=this._mixerPeerKeyToProvidedUserIDDict[t[n]]:"string"==typeof s.J&&(o.providedUserID=s.J,this._mixerPeerKeyToProvidedUserIDDict[t[n]]=o.providedUserID),this._mixerPeerKeyToHashedVisitIDDict[t[n]]?o.hashedVisitID=this._mixerPeerKeyToHashedVisitIDDict[t[n]]:"string"==typeof s.e&&(o.hashedVisitID=s.e,this._mixerPeerKeyToHashedVisitIDDict[t[n]]=o.hashedVisitID);let r=!1;"number"==typeof s.x&&(o.position||(o.position=new a.Point3D),o.position.x=s.x/1e3,r=!0),"number"==typeof s.y&&(o.position||(o.position=new a.Point3D),o.position.y=s.y/1e3,r=!0),"number"==typeof s.z&&(o.position||(o.position=new a.Point3D),o.position.z=s.z/1e3,r=!0),"number"==typeof s.k&&(o.orientationEuler||(o.orientationEuler=new a.OrientationEuler3D),o.orientationEuler.pitchDegrees=s.k,r=!0),"number"==typeof s.o&&(o.orientationEuler||(o.orientationEuler=new a.OrientationEuler3D),o.orientationEuler.yawDegrees=s.o,r=!0),"number"==typeof s.l&&(o.orientationEuler||(o.orientationEuler=new a.OrientationEuler3D),o.orientationEuler.rollDegrees=s.l,r=!0),"number"==typeof s.W&&"number"==typeof s.X&&"number"==typeof s.Y&&"number"==typeof s.Z&&(o.orientationQuat=new a.OrientationQuat3D({w:s.W/1e3,x:s.X/1e3,y:s.Y/1e3,z:s.Z/1e3}),r=!0),"number"==typeof s.g&&(o.hiFiGain=s.g,r=!0),"number"==typeof s.v&&(o.volumeDecibels=s.v,r=!0),r&&e.push(o)}this.onUserDataUpdated&&e.length>0&&this.onUserDataUpdated(e)}}connect(){return n(this,void 0,void 0,(function*(){if(!this.webRTCAddress){let e="Couldn't connect: `this.webRTCAddress` is falsey!";return this.disconnect(),Promise.reject(e)}this._currentHiFiConnectionState=void 0;try{yield this._raviSignalingConnection.open(this.webRTCAddress)}catch(e){let t=`Couldn't open signaling connection to \`${this.webRTCAddress.slice(0,this.webRTCAddress.indexOf("token="))}<token redacted>\`! Error:\n${e}`;return this.disconnect(),Promise.reject(t)}try{yield this._raviSession.open(this._raviSignalingConnection)}catch(e){let t=`Couldn't open RAVI session associated with \`${this.webRTCAddress.slice(0,this.webRTCAddress.indexOf("token="))}<token redacted>\`! Error:\n${e}`;return this.disconnect(),Promise.reject(t)}let e;try{e=yield this.promiseToRunAudioInit()}catch(e){let t=`\`audionet.init\` command failed! Error:\n${e.error}`;return this.disconnect(),Promise.reject(t)}return this._raviSession.getCommandController().addBinaryHandler((e=>{this.handleRAVISessionBinaryData(e)}),!0),Promise.resolve(e)}))}disconnect(){return n(this,void 0,void 0,(function*(){function e(e,t,i){return n(this,void 0,void 0,(function*(){if(e){let n=e.getState();if(e&&n!==i)try{yield e.close(),s.HiFiLogger.log(`The RAVI ${t} closed successfully from state ${n}.`)}catch(e){s.HiFiLogger.warn(`The RAVI ${t} didn't close successfully from state ${n}! Error:\n${e}`)}else s.HiFiLogger.log(`The RAVI ${t} was already closed.`)}else s.HiFiLogger.warn(`The RAVI ${t} was missing.`);e=null}))}return yield e(this._raviSignalingConnection,"Signaling Connection",d.RaviSignalingStates.CLOSED),yield e(this._raviSession,"Session",l.RaviSessionStates.CLOSED),this._resetMixerInfo(),Promise.resolve("Successfully disconnected.")}))}setRAVIInputAudio(e,t=!1){return n(this,void 0,void 0,(function*(){let i=!1;if(this._raviSession){let n=this._raviSession.getStreamController();n?(n.setInputAudio(e,t),s.HiFiLogger.log("Successfully set input audio on _raviSession.streamController!"),i=!0):(s.HiFiLogger.warn("Couldn't set input audio on _raviSession.streamController: No `streamController`!"),i=!1)}else s.HiFiLogger.warn("Couldn't set input audio on _raviSession.streamController: No `_raviSession`!"),i=!1;if(i&&this._inputAudioMediaStreamIsStereo!=t)if(this._raviSession.getState()===l.RaviSessionStates.CONNECTED){let e;s.HiFiLogger.warn(`Stereo status has changed from ${this._inputAudioMediaStreamIsStereo} to ${t}; attempting to re-initialize with the mixer`);try{this._inputAudioMediaStreamIsStereo=t,e=yield this.promiseToRunAudioInit()}catch(e){let t=`Attempt to call \`audionet.init\` for change in stereo status failed! Error:\n${e.error}`;return Promise.reject(t)}}else this._inputAudioMediaStreamIsStereo=t;return i}))}setInputAudioMuted(e){return n(this,void 0,void 0,(function*(){let t=this._raviSession.getStreamController();if(!this._raviSession||!t)return s.HiFiLogger.warn("Couldn't set mute state: No `_raviSession`, or `_raviSession.getStreamController()` returned null."),!1;{let i=!1;if(navigator.permissions&&navigator.permissions.query){let e;try{e=yield navigator.permissions.query({name:"microphone"})}catch(e){}e&&"granted"===e.state&&(i=!0)}if(i&&"undefined"!=typeof self){let i=t._inputAudioStream;if(i&&e)return i.getTracks().forEach((e=>{this._cachedMediaTrackConstraints=e.getConstraints(),e.stop()})),t.setInputAudio(null),s.HiFiLogger.log("Successfully set mute state to `true` by stopping all input media tracks!"),!0;if(!i&&!e){let e=yield navigator.mediaDevices.getUserMedia({audio:this._cachedMediaTrackConstraints,video:!1});return t.setInputAudio(e),s.HiFiLogger.log("Successfully set mute state to `false` by getting new input media stream!"),!0}if(i&&!e)return i.getTracks().forEach((e=>{e.enabled=!0})),s.HiFiLogger.log("Successfully set mute state to `false` by enabling all tracks on `_raviSession.streamController._inputAudioStream`!"),!0;s.HiFiLogger.warn("Couldn't set mute state: No `_inputAudioStream` on `_raviSession.streamController`.")}else{let i=t._inputAudioStream;if(i)return i.getTracks().forEach((t=>{t.enabled=!e})),s.HiFiLogger.log(`Successfully set mute state to ${e} on _raviSession.streamController._inputAudioStream`),!0;s.HiFiLogger.warn("Couldn't set mute state: No `_inputAudioStream` on `_raviSession.streamController`.")}}}))}getOutputAudioMediaStream(){if(!this._raviSession)return null;let e=this._raviSession.getStreamController();return e?e.getAudioStream():null}onRAVISignalingStateChanged(e){switch(s.HiFiLogger.log(`New RAVI signaling state: \`${e.state}\``),e.state){case d.RaviSignalingStates.UNAVAILABLE:this._currentHiFiConnectionState=o.HiFiConnectionStates.Unavailable,this.onConnectionStateChanged&&this.onConnectionStateChanged(this._currentHiFiConnectionState),this.disconnect()}}onRAVISessionStateChanged(e){switch(s.HiFiLogger.log(`New RAVI session state: \`${e.state}\``),e.state){case l.RaviSessionStates.CONNECTED:this._mixerPeerKeyToProvidedUserIDDict={},this._mixerPeerKeyToHashedVisitIDDict={},this._currentHiFiConnectionState=o.HiFiConnectionStates.Connected,this.onConnectionStateChanged&&this.onConnectionStateChanged(this._currentHiFiConnectionState);break;case l.RaviSessionStates.DISCONNECTED:if(this._currentHiFiConnectionState===o.HiFiConnectionStates.Unavailable)break;this._currentHiFiConnectionState=o.HiFiConnectionStates.Disconnected,this.onConnectionStateChanged&&this.onConnectionStateChanged(this._currentHiFiConnectionState);break;case l.RaviSessionStates.FAILED:if(this._currentHiFiConnectionState===o.HiFiConnectionStates.Unavailable)break;this._currentHiFiConnectionState=o.HiFiConnectionStates.Failed,this.onConnectionStateChanged&&this.onConnectionStateChanged(this._currentHiFiConnectionState)}}startCollectingWebRTCStats(e){this._raviSession?(this._statsObserverCallback&&this.stopCollectingWebRTCStats(),this._statsObserverCallback=e,this._raviSession.addStatsObserver(this._statsObserverCallback)):s.HiFiLogger.error("Couldn't start collecting WebRTC stats: No `_raviSession`!")}stopCollectingWebRTCStats(){this._raviSession?(this._raviSession.removeStatsObserver(this._statsObserverCallback),this._statsObserverCallback=void 0):s.HiFiLogger.error("Couldn't stop collecting WebRTC stats: No `_raviSession`!")}_transmitHiFiAudioAPIDataToServer(e){if(!this.mixerInfo.connected||!this._raviSession)return{success:!1,error:"Can't transmit data to mixer; not connected to mixer."};let t={};if(e.position){let i=u.HiFiAxisUtilities.translatePoint3DToMixerSpace(u.ourHiFiAxisConfiguration,e.position);"number"==typeof i.x&&(t.x=Math.round(1e3*i.x)),"number"==typeof i.y&&(t.y=Math.round(1e3*i.y)),"number"==typeof i.z&&(t.z=Math.round(1e3*i.z))}if(e.orientationEuler){let i=u.HiFiAxisUtilities.translateOrientationEuler3DToMixerSpace(u.ourHiFiAxisConfiguration,e.orientationEuler);"number"==typeof i.pitchDegrees&&(t.k=i.pitchDegrees),"number"==typeof i.yawDegrees&&(t.o=i.yawDegrees),"number"==typeof i.rollDegrees&&(t.l=i.rollDegrees)}if(e.orientationQuat&&("number"==typeof e.orientationQuat.w&&(t.W=1e3*e.orientationQuat.w),"number"==typeof e.orientationQuat.x&&(t.X=1e3*e.orientationQuat.x),"number"==typeof e.orientationQuat.y&&(t.Y=1e3*e.orientationQuat.y),"number"==typeof e.orientationQuat.z&&(t.Z=1e3*e.orientationQuat.z)),"number"==typeof e.volumeThreshold&&(t.T=e.volumeThreshold),"number"==typeof e.hiFiGain&&(t.g=Math.max(0,e.hiFiGain)),"number"==typeof e.userAttenuation&&(t.a=e.userAttenuation),"number"==typeof e.userRolloff&&(t.r=Math.max(0,e.userRolloff)),0===Object.keys(t).length)return{success:!0,stringifiedDataForMixer:JSON.stringify({})};{let e=this._raviSession.getCommandController();if(e){let i=JSON.stringify(t);return e.sendInput(i),{success:!0,stringifiedDataForMixer:i}}return{success:!1,error:"Can't transmit data to mixer; no `commandController`!."}}}_resetMixerInfo(){this.mixerInfo={connected:!1}}}},817:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.UserDataSubscription=t.AvailableUserDataSubscriptionComponents=void 0,(i=t.AvailableUserDataSubscriptionComponents||(t.AvailableUserDataSubscriptionComponents={})).Position="Position",i.OrientationEuler="Orientation (Euler)",i.OrientationQuat="Orientation (Quaternion)",i.VolumeDecibels="Volume (Decibels)",i.HiFiGain="HiFiGain",t.UserDataSubscription=class{constructor({providedUserID:e=null,components:t,callback:i}){this.providedUserID=e,this.components=t,this.callback=i}}},709:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HiFiConstants=void 0;class i{constructor(){}}t.HiFiConstants=i,i.MIN_TRANSMIT_RATE_LIMIT_TIMEOUT_MS=10,i.DEFAULT_TRANSMIT_RATE_LIMIT_TIMEOUT_MS=50,i.DEFAULT_PROD_HIGH_FIDELITY_ENDPOINT="api.highfidelity.com"},607:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=i(441),a=i(468),s=i(817),o=i(649),r=i(24),l=i(709),d=i(641);let u="undefined"!=typeof self;u&&(t.HiFiAPIVersion="v0.4.3"),t.HiFiCommunicator=a.HiFiCommunicator,t.HiFiConnectionStates=a.HiFiConnectionStates,t.HiFiUserDataStreamingScopes=a.HiFiUserDataStreamingScopes,t.AvailableUserDataSubscriptionComponents=s.AvailableUserDataSubscriptionComponents,t.UserDataSubscription=s.UserDataSubscription,t.ReceivedHiFiAudioAPIData=n.ReceivedHiFiAudioAPIData,t.HiFiAudioAPIData=n.HiFiAudioAPIData,t.Point3D=n.Point3D,t.OrientationEuler3D=n.OrientationEuler3D,t.OrientationQuat3D=n.OrientationQuat3D,t.HiFiLogger=o.HiFiLogger,t.HiFiLogLevel=o.HiFiLogLevel,t.getBestAudioConstraints=r.getBestAudioConstraints,t.preciseInterval=r.preciseInterval,t.HiFiConstants=l.HiFiConstants,t.HiFiAxes=d.HiFiAxes,t.HiFiHandedness=d.HiFiHandedness,t.HiFiAxisConfiguration=d.HiFiAxisConfiguration,u&&(t.apiVersion="v0.4.3"),t.Communicator=a.HiFiCommunicator,t.ConnectionStates=a.HiFiConnectionStates,t.UserDataStreamingScopes=a.HiFiUserDataStreamingScopes,t.AvailableUserDataSubscriptionComponents=s.AvailableUserDataSubscriptionComponents,t.UserDataSubscription=s.UserDataSubscription,t.ReceivedAudioAPIData=n.ReceivedHiFiAudioAPIData,t.AudioAPIData=n.HiFiAudioAPIData,t.Point3D=n.Point3D,t.OrientationEuler3D=n.OrientationEuler3D,t.OrientationQuat3D=n.OrientationQuat3D,t.Logger=o.HiFiLogger,t.LogLevel=o.HiFiLogLevel,t.getBestAudioConstraints=r.getBestAudioConstraints,t.preciseInterval=r.preciseInterval,t.Constants=l.HiFiConstants,t.Axes=d.HiFiAxes,t.Handedness=d.HiFiHandedness,t.AxisConfiguration=d.HiFiAxisConfiguration},318:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RaviCommandController=void 0;const n=i(425),a="_BINARY";var s;!function(e){e[e.ControlLeft=0]="ControlLeft",e[e.AltLeft=1]="AltLeft",e[e.OSLeft=2]="OSLeft",e[e.Space=3]="Space",e[e.OSRight=4]="OSRight",e[e.AltRight=5]="AltRight",e[e.ControlRight=6]="ControlRight",e[e.ShiftLeft=7]="ShiftLeft",e[e.ShiftRight=8]="ShiftRight",e[e.Comma=9]="Comma",e[e.Period=10]="Period",e[e.Slash=11]="Slash",e[e.CapsLock=12]="CapsLock",e[e.Enter=13]="Enter",e[e.Semicolon=14]="Semicolon",e[e.Quote=15]="Quote",e[e.Tab=16]="Tab",e[e.BracketLeft=17]="BracketLeft",e[e.BracketRight=18]="BracketRight",e[e.Backslash=19]="Backslash",e[e.Backquote=20]="Backquote",e[e.Minus=21]="Minus",e[e.Equal=22]="Equal",e[e.Digit0=23]="Digit0",e[e.Digit1=24]="Digit1",e[e.Digit2=25]="Digit2",e[e.Digit3=26]="Digit3",e[e.Digit4=27]="Digit4",e[e.Digit5=28]="Digit5",e[e.Digit6=29]="Digit6",e[e.Digit7=30]="Digit7",e[e.Digit8=31]="Digit8",e[e.Digit9=32]="Digit9",e[e.Backspace=33]="Backspace",e[e.Escape=34]="Escape",e[e.ArrowLeft=35]="ArrowLeft",e[e.ArrowRight=36]="ArrowRight",e[e.ArrowDown=37]="ArrowDown",e[e.ArrowUp=38]="ArrowUp",e[e.PageDown=39]="PageDown",e[e.PageUp=40]="PageUp",e[e.End=41]="End",e[e.Home=42]="Home",e[e.Delete=43]="Delete",e[e.Insert=44]="Insert",e[e.Numpad0=45]="Numpad0",e[e.Numpad1=46]="Numpad1",e[e.Numpad2=47]="Numpad2",e[e.Numpad3=48]="Numpad3",e[e.Numpad4=49]="Numpad4",e[e.Numpad5=50]="Numpad5",e[e.Numpad6=51]="Numpad6",e[e.Numpad7=52]="Numpad7",e[e.Numpad8=53]="Numpad8",e[e.Numpad9=54]="Numpad9",e[e.NumpadDecimal=55]="NumpadDecimal",e[e.NumpadEnter=56]="NumpadEnter",e[e.NumpadAdd=57]="NumpadAdd",e[e.NumpadSubtract=58]="NumpadSubtract",e[e.NumLock=59]="NumLock",e[e.NumpadEqual=60]="NumpadEqual",e[e.NumpadMultiply=61]="NumpadMultiply",e[e.NumpadDivide=62]="NumpadDivide",e[e.KeyA=63]="KeyA",e[e.KeyB=64]="KeyB",e[e.KeyC=65]="KeyC",e[e.KeyD=66]="KeyD",e[e.KeyE=67]="KeyE",e[e.KeyF=68]="KeyF",e[e.KeyG=69]="KeyG",e[e.KeyH=70]="KeyH",e[e.KeyI=71]="KeyI",e[e.KeyJ=72]="KeyJ",e[e.KeyK=73]="KeyK",e[e.KeyL=74]="KeyL",e[e.KeyM=75]="KeyM",e[e.KeyN=76]="KeyN",e[e.KeyO=77]="KeyO",e[e.KeyP=78]="KeyP",e[e.KeyQ=79]="KeyQ",e[e.KeyR=80]="KeyR",e[e.KeyS=81]="KeyS",e[e.KeyT=82]="KeyT",e[e.KeyU=83]="KeyU",e[e.KeyV=84]="KeyV",e[e.KeyW=85]="KeyW",e[e.KeyX=86]="KeyX",e[e.KeyY=87]="KeyY",e[e.KeyZ=88]="KeyZ"}(s||(s={})),t.RaviCommandController=class{constructor(){n.RaviUtils.log("constructor","RaviCommandController"),this._commandQueueMap=new Map,this._numQueuedCommands=0,this._commandQueueInterval=1e3,this._commandPumpTimer=null,this._inputTarget,this._keyboardTarget,this._mouseStateBuffer=new ArrayBuffer(32),this._mouseStateUint8=new Uint8Array(this._mouseStateBuffer),this._mouseStateUint8[0]=77,this._mouseStateFloat=new Float32Array(this._mouseStateBuffer,4),this._mouseStateFloat[0]=-1,this._mouseStateFloat[1]=-1,this._mouseStateFloat[2]=-1,this._mouseStateFloat[3]=-1,this._keyboardStateBuffer=new ArrayBuffer(13),this._keyboardState=new Uint8Array(this._keyboardStateBuffer),this._keyboardState[0]=75}setCommandQueueInterval(e){this._commandQueueInterval=e,this._commandPumpTimer&&(this.stopMonitoringQueues(),this.monitorQueues())}queueCommand(e,t,i){var a=this._commandQueueMap.get(e);a||(a={toSend:[],listener:[]},this._commandQueueMap.set(e,a));var s=null;i&&(s=new r(i,!1,!0)),a.toSend.push(new o(e,t,s)),this._numQueuedCommands++,n.RaviUtils.log("Added command "+e,"RaviCommandController")}queueBinaryCommand(e){let t=a;var i=this._commandQueueMap.get(t);i||(i={toSend:[],listener:[]},this._commandQueueMap.set(t,i)),i.toSend.push(new o(e,null,null)),this._numQueuedCommands++,n.RaviUtils.log("Added binary command","RaviCommandController")}addMessageHandler(e,t,i){var n=this._commandQueueMap.get(e);n||(n={toSend:[],listener:[]},this._commandQueueMap.set(e,n));var a=new r(t,i,!1);n.listener.push(a)}addBinaryHandler(e,t){this.addMessageHandler(a,e,t)}sendInput(e){this._inputDataChannel&&"open"===this._inputDataChannel.readyState&&this._inputDataChannel.send(e)}monitorQueues(){n.RaviUtils.log("Begin monitoring for queued commands","RaviCommandController"),this._commandPumpTimer=setInterval(this._processSendingQueuedCommands.bind(this),this._commandQueueInterval)}stopMonitoringQueues(){n.RaviUtils.log("Stop monitoring for queued commands","RaviCommandController"),clearInterval(this._commandPumpTimer),this._commandPumpTimer=null}_processSendingQueuedCommands(){this._numQueuedCommands<=0||this._commandQueueMap.forEach(function(e,t,i){if(e.toSend.length){var a=e.toSend.shift();a._handler&&e.listener.push(a._handler),this._sendCommandInstance(a)?this._numQueuedCommands--:n.RaviUtils.log("Send failed. CommandDataChannel may have been disconnected. Will not retry.","RaviCommandController")}}.bind(this))}_serializeJsonCommandMessageToSend(e,t){return JSON.stringify({c:e,p:t})}_unserializeJsonCommandMessageFromReceived(e){let t;try{t=JSON.parse(e)}catch(t){return void n.RaviUtils.err(`Couldn't parse command message! Error:\n${t}\n Full message contents:\n${e}`,"RaviCommandController")}return t&&t.c&&t.p?{command:t.c,payload:t.p}:(n.RaviUtils.err("Message cannot be unserialized into a CommandMessage: "+e,"RaviCommandController"),null)}_sendCommandInstance(e){try{let t=e._command;return"string"==typeof t?(t=this._serializeJsonCommandMessageToSend(e._command,e._param),n.RaviUtils.log("Sending command "+t,"RaviCommandController")):n.RaviUtils.log("Sending binary command","RaviCommandController"),this._commandDataChannel.send(t),!0}catch(e){return n.RaviUtils.err("Received error while sending: "+e.message,"RaviCommandController"),!1}}_processListeningCommand(e){let t=e.data,i=null;t&&("string"==typeof t?(i=this._unserializeJsonCommandMessageFromReceived(t),this._continueProcessingListeningCommand(i)):t instanceof ArrayBuffer?(i={command:a,payload:new Uint8Array(t)},this._continueProcessingListeningCommand(i)):t instanceof Blob&&t.arrayBuffer().then((e=>{i={command:a,payload:new Uint8Array(e)},this._continueProcessingListeningCommand(i)})))}_continueProcessingListeningCommand(e){if(e){n.RaviUtils.log("_continueProcessingListeningCommand: "+e,"RaviCommandController");var t=this._commandQueueMap.get(e.command);if(t){var i=t.listener.length;if(i>0)if(t.listener[0]&&t.listener[0]._hasMatchingSentCommand){var a=t.listener.shift();if(a&&a._handler)return void a._handler(e.payload);n.RaviUtils.err("Undefined command handler: "+e,"RaviCommandController")}else{for(var s=[],o=0;o<i;o++){var r=t.listener[o];r&&r._handler?r._handler(e.payload):n.RaviUtils.err("Undefined message handler: "+e,"RaviCommandController"),r&&r._isSticky&&s.push(r)}t.listener=s}}}else n.RaviUtils.err("Received invalid command message, ignoring: "+JSON.stringify(e),"RaviCommandController")}_setInputDataChannel(e){this._inputDataChannel=e,n.RaviUtils.log("Received new input data channel with id "+this._inputDataChannel.id,"RaviCommandController"),this._inputDataChannel.onopen=function(){n.RaviUtils.log("_inputDataChannel onopen, state is "+this._inputDataChannel.readyState,"RaviCommandController")}.bind(this),this._inputDataChannel.onclose=function(){n.RaviUtils.log("_inputDataChannel onclose, state is "+this._inputDataChannel.readyState,"RaviCommandController")}.bind(this),this._inputDataChannel.onmessage=function(e){n.RaviUtils.log("_inputDataChannel got message: "+e.data,"RaviCommandController")}.bind(this)}_setCommandDataChannel(e){this._commandDataChannel=e,n.RaviUtils.log("Received new data channel with id "+this._commandDataChannel.id,"RaviCommandController"),this._commandDataChannel.onopen=function(){n.RaviUtils.log("_commandDataChannel ononpen, state is "+this._commandDataChannel.readyState,"RaviCommandController"),this.monitorQueues()}.bind(this),this._commandDataChannel.onclose=function(){n.RaviUtils.log("_commandDataChannel onclose, state is "+this._commandDataChannel.readyState,"RaviCommandController"),this.stopMonitoringQueues()}.bind(this),this._commandDataChannel.onmessage=function(e){this._processListeningCommand(e)}.bind(this)}setInputTarget(e){if(this._inputTarget&&(this._inputTarget.onmousemove=null,this._inputTarget.onmouseenter=null,this._inputTarget.onmouseleave=null,this._inputTarget.onmousedown=null,this._inputTarget.onmouseup=null,this._inputTarget.onwheel=null),this._inputTarget=e,this._inputTarget){var t=this;this._inputTarget.onmousemove=function(e){t._trackMouse(e)},this._inputTarget.onmouseenter=null,this._inputTarget.onmouseleave=null,this._inputTarget.onmousedown=function(e){t._captureMouseDown(e)},this._inputTarget.onmouseup=function(e){t._resetMouseDown(e)},this._inputTarget.onwheel=function(e){t._wheelMouse(e)}}}setKeyboardTarget(e){if(this._keyboardTarget&&(this._keyboardTarget.onkeydown=null,this._keyboardTarget.onkeyup=null),this._keyboardTarget=e,this._keyboardTarget){var t=this;this._keyboardTarget.onkeydown=function(e){t._onKeyboardDown(e)},this._keyboardTarget.onkeyup=function(e){t._onKeyboardUp(e)}}}_captureMouseDown(e){this._mouseStateFloat[0]=e.offsetX,this._mouseStateFloat[1]=e.offsetY,this._mouseStateFloat[2]=e.offsetX,this._mouseStateFloat[3]=e.offsetY,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_resetMouseDown(e){this._mouseStateFloat[0]=-1,this._mouseStateFloat[1]=-1,this._mouseStateFloat[2]=-1,this._mouseStateFloat[3]=-1,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_trackMouse(e){this._mouseStateFloat[0]=e.offsetX,this._mouseStateFloat[1]=e.offsetY,this._mouseStateFloat[4]=this._inputTarget.offsetWidth,this._mouseStateFloat[5]=this._inputTarget.offsetHeight,this._mouseStateUint8[1]=e.buttons,this._sendMouseState()}_wheelMouse(e){this._mouseStateFloat[6]=e.deltaY,this._sendMouseState(),this._mouseStateFloat[6]=0}_sendMouseState(){this.sendInput(this._mouseStateBuffer)}_keyByteNum(e){return e>>3}_keyBitMask(e){return 1<<e%8}_onKeyboardDown(e){let t=s[e.code],i=1+this._keyByteNum(t),n=this._keyBitMask(t);0==(this._keyboardState[i]&n)&&(this._keyboardState[i]|=n,this._sendKeyboardState())}_onKeyboardUp(e){let t=s[e.code],i=1+this._keyByteNum(t),n=this._keyBitMask(t);0!=(this._keyboardState[i]&n)&&(this._keyboardState[i]^=n,this._sendKeyboardState())}_sendKeyboardState(){this.sendInput(this._keyboardStateBuffer)}};class o{constructor(e,t,i){n.RaviUtils.log("constructor","RaviCommandInstance"),this._command=e,this._param=t,this._handler=i}}class r{constructor(e,t,i){n.RaviUtils.log("constructor","RaviCommandHandlerInstance"),this._handler=e,this._isSticky=t,this._hasMatchingSentCommand=i}}},665:function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(a,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RaviSession=t.RaviSessionStates=void 0;const a=i(562),s=i(425),o=i(318);var r;!function(e){e.NEW="new",e.CONNECTING="checking",e.CONNECTED="connected",e.COMPLETED="completed",e.DISCONNECTED="disconnected",e.FAILED="failed",e.CLOSED="closed"}(r=t.RaviSessionStates||(t.RaviSessionStates={})),t.RaviSession=class{constructor(){s.RaviUtils.log("Constructor","RaviSession"),this._stateChangeHandlers=new Set,this._uuid=s.RaviUtils.createUUID(),this._commandController=new o.RaviCommandController,this._streamController=new a.RaviStreamController(this._commandController),this._state=r.CLOSED,this._raviImplementation=new _(this);const e=this._raviImplementation;this._streamController.setInputAudioChangeHandler(e._addAudioInputStream.bind(e)),this._streamController.setInputVideoChangeHandler(e._addVideoInputStream.bind(e))}getState(){return this._state}getUUID(){return this._uuid}addStateChangeHandler(e){try{return this._stateChangeHandlers.add(e),!0}catch(e){return s.RaviUtils.err("Error adding a state change handler: "+e.message,"RaviSession"),!1}return!1}removeStateChangeHandler(e){try{return this._stateChangeHandlers.delete(e),!0}catch(e){return s.RaviUtils.err("Error removing a state change handler: "+e.message,"RaviSession"),!1}return!1}getCommandController(){return this._commandController}getStreamController(){return this._streamController}open(e,t=5e3,i=null){var n=this;return this._raviImplementation._assignSignalingConnection(e),new Promise(((e,a)=>{s.RaviUtils.log("Opening RAVI session","RaviSession");let o=setTimeout((()=>{s.RaviUtils.log("RaviSession.open timed out after "+t+" ms","RaviSession"),a(Error("RaviSession.open timed out")),n.close()}),t);const l=function(t){var i="";t&&t.state&&(i=t.state),i===r.NEW||i===r.CONNECTING||i===r.DISCONNECTED?s.RaviUtils.log("RAVI session state is "+i,"RaviSession"):i===r.CONNECTED||i===r.COMPLETED?(d(),e(i)):i===r.FAILED?(d(),setTimeout((()=>{n._raviImplementation._close()}),0),a(Error(i))):i===r.CLOSED&&(d(),a(Error(i)))},d=function(){n.removeStateChangeHandler(l),o&&(clearTimeout(o),o=null)};n.addStateChangeHandler(l),n._raviImplementation._open(i)}))}close(){var e=this;return this._streamController._stop(),this._commandController.stopMonitoringQueues(),new Promise(((t,i)=>{s.RaviUtils.log("Closing RAVI session","RaviSession");const n=function(a){var o="";a&&a.state&&(o=a.state),o===r.DISCONNECTED?s.RaviUtils.log("Closing...","RaviSession"):o===r.CLOSED?(e.removeStateChangeHandler(n),t(o)):(e.removeStateChangeHandler(n),i(Error(o)))};e.addStateChangeHandler(n);var a={state:r.DISCONNECTED};e._handleStateChange(a,r.DISCONNECTED),e._raviImplementation._close()}))}_doOntrack(e){s.RaviUtils.log("Received new track: ","RaviSession"),s.RaviUtils.log(e,"RaviSession"),e&&e.track&&"video"===e.track.kind&&(s.RaviUtils.log("Adding remote video track to stream controller","RaviSession"),this._streamController._setVideoStream(e.streams[0]),this._streamController._onVideoStreamStateChanged("ready")),e&&e.track&&"audio"===e.track.kind&&(s.RaviUtils.log("Adding remote audio track to stream controller","RaviSession"),this._streamController._setAudioStream(e.streams[0]))}_doOndatachannel(e){switch(s.RaviUtils.log("Received new channel: ","RaviSession"),s.RaviUtils.log(e,"RaviSession"),e.channel.label){case"ravi.input":this._commandController._setInputDataChannel(e.channel);break;case"ravi.command":this._commandController._setCommandDataChannel(e.channel);break;default:s.RaviUtils.log("Received unknown data channel named "+e.channel.label,"RaviSession")}}_handleStateChange(e,t){this._state=t,e&&(e.state=t,s.RaviUtils.log("_handleStateChange: "+JSON.stringify(e),"RaviSession"),this._stateChangeHandlers.forEach((function(t){t&&t(e)})))}addStatsObserver(e){return this._raviImplementation._addStatsObserver(e)}removeStatsObserver(e){return this._raviImplementation._removeStatsObserver(e)}};const l=new Map([["remote-inbound-rtp",["id","type","timestamp","roundTripTime","jitter"]],["inbound-rtp",["id","type","timestamp","jitterBufferDelay","jitterBufferEmittedCount","bytesReceived"]]]);class d{constructor(e){s.RaviUtils.log("constructor","RaviStatsWatcher"),this._raviImplementation=e,this._observers=new Set,this._filter=l,this._interval=0,this._prevStats=[]}stop(){this._interval&&(window.clearInterval(this._interval),this._interval=0)}addObserver(e){try{return this._observers.add(e),this._onObserverChange(),!0}catch(e){return s.RaviUtils.err("Error adding a stats observer: "+e.message,"RaviStatsWatcher"),!1}return!1}removeObserver(e){try{return this._observers.delete(e),this._onObserverChange(),!0}catch(e){return s.RaviUtils.err("Error removing a stats observer handler: "+e.message,"RaviSession"),!1}return!1}_onObserverChange(){this._prevStats=[],this._observers.size>0?this._interval||window.setInterval(((e,t)=>n(this,void 0,void 0,(function*(){const e=yield this._raviImplementation._getStats();let t=[];e&&e.forEach((e=>{if(this._filter.has(e.type)){let i=this._filter.get(e.type),n={};i.forEach((t=>{n[t]=e[t]})),t.push(n)}})),t.length&&this._observers.forEach((e=>{e(t,this._prevStats)})),this._prevStats=t}))),1e3):this._interval&&(window.clearInterval(this._interval),this._interval=0)}}let u=null,h=null;"undefined"==typeof self?(u=i(326).I$,h=i(326).Ao):(u=RTCPeerConnection,h=RTCSessionDescription);const c={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:turn.highfidelity.com:3478",username:"clouduser",credential:"chariot-travesty-hook"}]};class _{constructor(e){s.RaviUtils.log("constructor","RaviWebRTCImplementation"),this._raviSession=e,this._negotiator=this._setupConnection.bind(this),this._initRtcConnection(),this._statsWatcher=new d(this)}_initRtcConnection(){const e=this._raviSession,t=this;this._rtcConnection=new u(c);const i=this._rtcConnection;i.getSenders().forEach((e=>{e.replaceTrack(null)})),this._raviAudioSenders=[],this._raviVideoSenders=[],i.addEventListener("iceconnectionstatechange",(function(t){e._handleStateChange(t,i.iceConnectionState)})),i.addEventListener("datachannel",(function(t){e._doOndatachannel(t)})),i.addEventListener("track",(function(t){e._doOntrack(t)})),i.addEventListener("icecandidate",(function(e){t._doOnicecandidate(e)})),i.addEventListener("negotiationneeded",(function(e){t._doOnnegotiationneeded(e)})),i.addEventListener("signalingstatechange",(function(e){t._doOnsignalingstatechanged(e)}))}_assignSignalingConnection(e){this._signalingConnection=e}_addAudioInputStream(e){const t=this._rtcConnection;if(e){const i=this._raviAudioSenders,n=e.getAudioTracks(),a=n.length;let o=0;for(;o<i.length;o++)o<a?(s.RaviUtils.log("Replacing audio track #"+o+"  in rtcConnection","RaviWebRTCImplementation"),i[o].replaceTrack(n[o])):(s.RaviUtils.log("Setting audio sender #"+o+" to null","RaviWebRTCImplementation"),i[o].replaceTrack(null));for(;o<a;o++)s.RaviUtils.log("Adding local audio track #"+o+" to rtcConnection","RaviWebRTCImplementation"),i.push(t.addTrack(n[o],e))}else{const e=this._raviAudioSenders;let t=0;for(;t<e.length;t++)s.RaviUtils.log("Setting audio sender #"+t+" to null","RaviWebRTCImplementation"),e[t].replaceTrack(null)}return!1}_addVideoInputStream(e){const t=this._rtcConnection;var i=!1;if(e){const n=this._raviVideoSenders,a=e.getVideoTracks();a.length>0?(n.length>0?(s.RaviUtils.log("Replacing video track #0 in rtcConnection","RaviWebRTCImplementation"),n[0].replaceTrack(a[0])):(s.RaviUtils.log("Adding video track #0 to rtcConnection","RaviWebRTCImplementation"),n.push(t.addTrack(a[0]))),i=!0):s.RaviUtils.log("Assigned video stream doesn't contain vidoe track","RaviWebRTCImplementation")}else{const e=this._raviVideoSenders;let t=0;for(;t<e.length;t++)s.RaviUtils.log("Setting video sender #"+t+" to null","RaviWebRTCImplementation"),e[t].replaceTrack(null)}return i}_open(e){if(s.RaviUtils.log("Attempting to open connection...","RaviWebRTCImplementation"),"connecting"==this._rtcConnection.connectionState||"connected"==this._rtcConnection.connectionState)return s.RaviUtils.log("We already have a connection in progress. Will not attempt a new one.","RaviWebRTCImplementation"),void this._raviSession._handleStateChange({state:this._rtcConnection.connectionState},this._rtcConnection.connectionState);if(this._signalingConnection){this._signalingConnection.addMessageHandler(this._negotiator);let t={};e?(t=e,t.sessionID=this._raviSession.getUUID()):t=this._raviSession.getUUID(),this._signalingConnection.send(JSON.stringify({request:t}))}}_close(){if(this._rtcConnection){this._statsWatcher.stop(),s.RaviUtils.log("closing","RaviWebRTCImplementation"),this._rtcConnection.close(),this._rtcConnection=null;var e={state:r.CLOSED};this._raviSession._handleStateChange(e,r.CLOSED),this._signalingConnection.removeMessageHandler(this._negotiator),this._initRtcConnection()}}_doOnicecandidate(e){e.candidate&&""!=e.candidate?(s.RaviUtils.log("Sending local ICE candidate: "+JSON.stringify(e.candidate),"RaviWebRTCImplementation"),this._signalingConnection.send(JSON.stringify({ice:e.candidate,uuid:this._raviSession.getUUID()}))):s.RaviUtils.log("End of local ICE candidates","RaviSession")}_doOnnegotiationneeded(e){s.RaviUtils.log("need renegotiation please","RaviWebRTCImplementation");const t={renegotiate:"please",uuid:this._raviSession.getUUID()},i=JSON.stringify(t);this._signalingConnection&&"stable"===this._rtcConnection.signalingState&&this._signalingConnection.send(i)}_doOnsignalingstatechanged(e){s.RaviUtils.log("SignalingState changed: "+this._rtcConnection.signalingState,"RaviWebRTCImplementation")}_forceBitrateUp(e){const t=this._raviSession._streamController.isStereoInput()?128e3:64e3;return e.replace(/a=fmtp:111 /g,"a=fmtp:111 maxaveragebitrate="+t+";")}_forceStereoDown(e){return e.replace(/a=fmtp:111 /g,"a=fmtp:111 maxaveragebitrate=128000;sprop-stereo=1;stereo=1;")}_setupConnection(e){let t="",i="";const n=this._raviSession,a=this._rtcConnection,o=this._signalingConnection,r=this;if(n&&a&&o)if(e&&e.data){if(s.RaviUtils.log("Message from server: "+e.data,"RaviWebRTCImplementation"),t=JSON.parse(e.data),i=t[n.getUUID()],i)if(i.sdp){s.RaviUtils.log("Got sdp of type:"+i.type,"RaviWebRTCImplementation"),i.sdp=r._forceBitrateUp(i.sdp);const e=new h(i);a.setRemoteDescription(e).then((function(){return a.createAnswer()})).then((function(e){return e.sdp=r._forceStereoDown(e.sdp),s.RaviUtils.log("Answer:","RaviWebRTCImplementation"),s.RaviUtils.log(e,"RaviWebRTCImplementation"),a.setLocalDescription(e)})).then((function(){const e={type:"answer",sdp:a.localDescription,uuid:n.getUUID()},t=JSON.stringify(e);s.RaviUtils.log("Sending answer to server","RaviWebRTCImplementation"),o.send(t)}))}else i.ice?(s.RaviUtils.log("Received remote ICE candidate: "+JSON.stringify(i.ice),"RaviWebRTCImplementation"),a.addIceCandidate(i.ice).then((function(){s.RaviUtils.log("Added remote candidate","RaviWebRTCImplementation")})).catch((function(e){s.RaviUtils.err("Error attempting to add remote ICE candidate: "+e.message,"RaviWebRTCImplementation")}))):s.RaviUtils.log("Unknown message "+JSON.stringify(i),"RaviWebRTCImplementation")}else s.RaviUtils.log("No message received by onMessage handler","RaviWebRTCImplementation");else s.RaviUtils.err("Missing one of raviSession, rtcConnection, or signalingConnection! Can't set up connection.","RaviWebRTCImplementation")}_addStatsObserver(e){return this._statsWatcher.addObserver(e)}_removeStatsObserver(e){return this._statsWatcher.removeObserver(e)}_getStats(e=null){return n(this,void 0,void 0,(function*(){return this._rtcConnection?this._rtcConnection.getStats(e):{}}))}}},212:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RaviSignalingConnection=t.RaviSignalingStates=void 0;const n=i(425);var a;!function(e){e.CONNECTING="connecting",e.OPEN="open",e.ERROR="error",e.CLOSING="closing",e.CLOSED="closed",e.UNAVAILABLE="unavailable"}(a=t.RaviSignalingStates||(t.RaviSignalingStates={})),t.RaviSignalingConnection=class{constructor(){n.RaviUtils.log("Constructor","RaviSignalingConnection"),this._stateChangeHandlers=new Set,this._messageHandlers=new Set,this._state=a.CLOSED,this._signalingImplementation=new o(this)}getState(){return this._state}addStateChangeHandler(e){try{return this._stateChangeHandlers.add(e),!0}catch(e){return n.RaviUtils.err("Error adding a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}removeStateChangeHandler(e){try{return this._stateChangeHandlers.delete(e),!0}catch(e){return n.RaviUtils.err("Error removing a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}addMessageHandler(e){try{return this._messageHandlers.add(e),!0}catch(e){return n.RaviUtils.err("Error adding a message handler: "+e.message,"RaviSignalingConnection"),!1}return!1}removeMessageHandler(e){try{return this._messageHandlers.delete(e),!0}catch(e){return n.RaviUtils.err("Error removing a state change handler: "+e.message,"RaviSignalingConnection"),!1}return!1}open(e){var t=this;return new Promise(((i,s)=>{n.RaviUtils.log("Opening signaling connection to "+e,"RaviSignalingController");const o=function(e){var r="";e&&e.state&&(r=e.state),r===a.CONNECTING?n.RaviUtils.log("Connecting...","RaviSignalingController"):r===a.OPEN?(t.removeStateChangeHandler(o),i(r)):(t.removeStateChangeHandler(o),s(e.error||new Error(e.message||r)))};t.addStateChangeHandler(o);var r={state:a.CONNECTING};this._handleStateChange(r,a.CONNECTING),this._signalingImplementation._open(e)}))}send(e){this._signalingImplementation._send(e)}close(){var e=this;return new Promise(((t,i)=>{n.RaviUtils.log("Closing signaling connection","RaviSignalingConnection");const s=function(o){var r="";o&&o.state&&(r=o.state),r===a.CLOSING?n.RaviUtils.log("Closing...","RaviSignalingConnection"):r===a.CLOSED?(e.removeStateChangeHandler(s),t(r)):(e.removeStateChangeHandler(s),i(Error(r)))};e.addStateChangeHandler(s);var o={state:a.CLOSING};this._handleStateChange(o,a.CLOSING),this._signalingImplementation._close()}))}_handleStateChange(e,t){this._state=t,e.state=t,n.RaviUtils.log("_handleStateChange: "+n.RaviUtils.safelyPrintable(e),"RaviSignalingConnection"),this._stateChangeHandlers.forEach((function(t){t&&t(e)}))}_handleMessage(e){if(n.RaviUtils.log("_doOnmessage: "+n.RaviUtils.safelyPrintable(e),"RaviSignalingConnection"),e.data)try{let t=JSON.parse(e.data);t.error&&"service-unavailable"==t.error&&this._handleStateChange({},a.UNAVAILABLE)}catch(e){}this._messageHandlers.forEach((function(t){t&&t(e)}))}};let s=null;s="undefined"==typeof self?i(26):WebSocket;class o{constructor(e){n.RaviUtils.log("constructor","RaviSignalingWebSocketImplementation"),this._raviSignalingConnection=e}_open(e){this._webSocket=new s(e);var t=this._raviSignalingConnection;this._webSocket.addEventListener("open",(function(e){t._handleStateChange(e,a.OPEN)})),this._webSocket.addEventListener("error",(function(e){t._handleStateChange(e,a.ERROR)})),this._webSocket.addEventListener("close",(function(e){t._handleStateChange(e,a.CLOSED)})),this._webSocket.addEventListener("message",(function(e){t._handleMessage(e)}))}_send(e){this._webSocket&&this._webSocket.readyState===s.OPEN&&(n.RaviUtils.log("Sending message to server: "+e,"RaviSignalingWebSocketImplementation"),this._webSocket.send(e))}_close(){this._webSocket&&(this._webSocket.close(),this._webSocket=null)}}e.exports.RaviSignalingStates=a},562:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RaviStreamController=void 0;const n=i(425);t.RaviStreamController=class{constructor(e){n.RaviUtils.log("constructor","RaviStreamController"),this._commandController=e,this._audioStream=null,this._videoStream=null,this._onVideoStreamStateChanged=function(e){n.RaviUtils.log("onvideostreamstatechanged "+e,"RaviStreamController")},this._onInputAudioChanged=null,this._onInputVideoChanged=null}getVideoStream(){return this._videoStream}_setVideoStream(e){this._videoStream=e,this._videoContainer&&(this._videoContainer.srcObject=this._videoStream)}setVideoContainer(e,t){this._videoContainer=e,this._videoStream&&(this._videoContainer.srcObject=this._videoStream),this.setVideoStateChangeHandler(t)}setVideoStateChangeHandler(e){e&&(this._onVideoStreamStateChanged=e)}showVideoDashboard(e){this._commandController.queueCommand("video.showDashboard",{enabled:e},null)}showVideoCursor(e){this._commandController.queueCommand("video.showCursor",{enabled:e},null)}getAudioStream(){return this._audioStream}_setAudioStream(e){this._audioStream=e,this._audioContainer&&(this._audioContainer.srcObject=this._audioStream)}setAudioContainer(e){this._audioContainer=e,this._audioStream&&(this._audioContainer.srcObject=this._audioStream)}setInputAudio(e,t=!1){this._inputAudioStream=e,this._isStereo=t,this._onInputAudioChanged&&this._onInputAudioChanged(e)}setInputAudioChangeHandler(e){e&&(this._onInputAudioChanged=e)}setInputVideo(e){this._inputVideoStream=e,this._onInputVideoChanged&&this._onInputVideoChanged(e)}setInputVideoChangeHandler(e){e&&(this._onInputVideoChanged=e)}isStereoInput(){return this._isStereo}_stop(){n.RaviUtils.log("stopping streams","RaviStreamController"),this._videoContainer&&this._videoContainer.srcObject&&(this._videoContainer.srcObject.getTracks().forEach((e=>e.stop())),this._videoContainer.srcObject=null,this._onVideoStreamStateChanged("over")),this._audioStream&&(this._audioStream.getTracks().forEach((e=>e.stop())),this._audioStream=null)}}},425:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RaviUtils=void 0;var i=!0;t.RaviUtils=class{static createUUID(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}static log(e,t){if(void 0!==t&&(e=t+": "+e),i&&console.log(e),"undefined"!=typeof document&&i)try{document.dispatchEvent(new CustomEvent("logger",{detail:e}))}catch(t){console.log(e),console.log("Additionally, an error was encountered trying to log that."),console.log(t)}}static err(e,t){void 0!==t&&(e=t+": "+e),console.log("%c %s","color: #FB0A1C",e),"undefined"!=typeof document&&document.dispatchEvent(new CustomEvent("errlogger",{detail:e}))}static safelyPrintable(e){try{return JSON.stringify(e)}catch(t){return e}}static getElementCSSSize(e){if(getComputedStyle){var t=getComputedStyle(e);return{width:parseInt(t.getPropertyValue("width"),10),height:parseInt(t.getPropertyValue("height"),10)}}}static setDebug(e){i=e}}},649:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.HiFiLogger=t.HiFiLogLevel=void 0,function(e){e.None="None",e.Error="Error",e.Warn="Warn",e.Debug="Debug"}(i=t.HiFiLogLevel||(t.HiFiLogLevel={}));class n{constructor(e){e=e||i.Debug}static setHiFiLogLevel(e){n.logLevel=e}static log(e){return n.logLevel===i.Debug&&(console.log(e),!0)}static debug(e){return this.log(e)}static warn(e){return(n.logLevel===i.Debug||n.logLevel===i.Warn)&&(console.warn(e),!0)}static error(e){return(n.logLevel===i.Debug||n.logLevel===i.Warn||n.logLevel===i.Error)&&(console.error(e),!0)}}t.HiFiLogger=n,n.logLevel=i.Error},24:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preciseInterval=t.getBestAudioConstraints=t.recursivelyDiffObjects=void 0;const n=i(649);let a;if("undefined"==typeof self)try{a=i(513).performance.now}catch(e){}t.recursivelyDiffObjects=function e(t,i){if(!i||"[object Object]"!==Object.prototype.toString.call(i))return t;let n,a={},s=(t,i,n)=>{let s=Object.prototype.toString.call(t),o=Object.prototype.toString.call(i);if("[object Undefined]"!==o)if(s===o)if("[object Object]"!==s)"[object Array]"!==s?"[object Function]"===s?t.toString()!==i.toString()&&(a[n]=i):t!==i&&(a[n]=i):((e,t)=>{if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0})(t,i)||(a[n]=i);else{let s=e(t,i);Object.keys(s).length>0&&(a[n]=s)}else a[n]=i;else a[n]=null};for(n in t)t.hasOwnProperty(n)&&s(t[n],i[n],n);for(n in i)i.hasOwnProperty(n)&&(t[n]||t[n]===i[n]||(a[n]=i[n]));return a},t.getBestAudioConstraints=function(){let e={};return"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().echoCancellation&&(e.echoCancellation=!1),"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().noiseSuppression&&(e.noiseSuppression=!1),"undefined"!=typeof navigator&&void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getSupportedConstraints&&navigator.mediaDevices.getSupportedConstraints().autoGainControl&&(e.autoGainControl=!1),e},t.preciseInterval=function(e,t){if(!a)return n.HiFiLogger.warn("`preciseInterval()` is a wrapper for `setInterval()` in the browser context!"),setInterval(e,t);let i=a(),s=clearTimeout,o=()=>{let n=a();if(n<i)return s=clearImmediate,r=setImmediate(o);i+=t,s=clearTimeout,r=setTimeout(o,i-n-2),e()},r=setTimeout(o);return{clear:()=>s(r)}}},326:(e,t)=>{"use strict";window.MediaStream,window.MediaStreamTrack,window.RTCDataChannel,window.RTCDataChannelEvent,window.RTCDtlsTransport,window.RTCIceCandidate,window.RTCIceTransport,t.I$=window.RTCPeerConnection,window.RTCPeerConnectionIceEvent,window.RTCRtpReceiver,window.RTCRtpSender,window.RTCRtpTransceiver,window.RTCSctpTransport,t.Ao=window.RTCSessionDescription,window.getUserMedia,navigator.mediaDevices},26:e=>{"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},513:()=>{}},t={};return function i(n){if(t[n])return t[n].exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,i),a.exports}(607)})();